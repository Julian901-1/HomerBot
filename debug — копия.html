<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HomerBot Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; background-color: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        textarea { width: 100%; height: 200px; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>HomerBot Debug Tool</h1>
    
    <div class="test-section">
        <h3>1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h3>
        <div id="config-result" class="result info">
            –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...
        </div>
    </div>

    <div class="test-section">
        <h3>2. –¢–µ—Å—Ç Google Apps Script URL</h3>
        <button onclick="testScriptUrl()">–¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</button>
        <div id="script-test-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>3. –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h3>
        <button onclick="testNotifications()">–¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</button>
        <div id="notification-test-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>4. –¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –±–∞–ª–∞–Ω—Å–∞</h3>
        <button onclick="testBalanceSync()">–¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</button>
        <div id="balance-test-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>5. –õ–æ–≥–∏ –∫–æ–Ω—Å–æ–ª–∏</h3>
        <textarea id="console-logs" readonly></textarea>
        <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
    </div>

<script>
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
var SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby63juAkVub8oT0LZT2K8bpQ8l4FzfOTPWdeEYRSvTQXqiO5mfCj3Qz07r-4Cx276WePQ/exec';
var BOT_TOKEN = '7631840452:AAH4O93qQ6J914x5FhPTQX7YhJC3bTiJ_XA';
var CHAT_ID = '487525838';

// –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
var logs = [];
function log(message) {
    var timestamp = new Date().toLocaleTimeString();
    var logMessage = timestamp + ': ' + message;
    logs.push(logMessage);
    console.log(logMessage);
    updateConsole();
}

function updateConsole() {
    document.getElementById('console-logs').value = logs.join('\n');
}

function clearLogs() {
    logs = [];
    updateConsole();
}

// –ü–µ—Ä–µ—Ö–≤–∞—Ç console.log
var originalLog = console.log;
console.log = function() {
    originalLog.apply(console, arguments);
    log(Array.from(arguments).join(' '));
};

// –ü–µ—Ä–µ—Ö–≤–∞—Ç console.error
var originalError = console.error;
console.error = function() {
    originalError.apply(console, arguments);
    log('ERROR: ' + Array.from(arguments).join(' '));
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function init() {
    log('Debug tool initialized');
    showConfig();
}

function showConfig() {
    var config = `
        SCRIPT_URL: ${SCRIPT_URL}
        BOT_TOKEN: ${BOT_TOKEN ? BOT_TOKEN.substring(0, 10) + '...' : 'NOT SET'}
        CHAT_ID: ${CHAT_ID}
        User Agent: ${navigator.userAgent}
        Current URL: ${window.location.href}
    `;
    document.getElementById('config-result').innerHTML = '<pre>' + config + '</pre>';
    log('Configuration loaded');
}

function testScriptUrl() {
    log('Testing Google Apps Script connection...');
    document.getElementById('script-test-result').innerHTML = '<div class="info">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...</div>';
    
    fetch(SCRIPT_URL + '?action=test&timestamp=' + Date.now(), {
        method: 'GET',
        mode: 'cors'
    })
    .then(response => {
        log('Response status: ' + response.status);
        return response.text();
    })
    .then(data => {
        log('Response data: ' + data);
        document.getElementById('script-test-result').innerHTML = '<div class="success">‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! –û—Ç–≤–µ—Ç: ' + data + '</div>';
    })
    .catch(error => {
        log('Connection error: ' + error.toString());
        document.getElementById('script-test-result').innerHTML = '<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è: ' + error.toString() + '</div>';
    });
}

function testNotifications() {
    log('Testing notification system...');
    document.getElementById('notification-test-result').innerHTML = '<div class="info">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...</div>';
    
    var testData = {
        action: 'sendNotification',
        type: 'strategy_change',
        userId: '@test_user',
        strategy: 'balanced',
        message: 'üîÑ –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç Debug Tool'
    };

    fetch(SCRIPT_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(testData)
    })
    .then(response => {
        log('Notification response status: ' + response.status);
        return response.json();
    })
    .then(result => {
        log('Notification result: ' + JSON.stringify(result));
        if (result.success) {
            document.getElementById('notification-test-result').innerHTML = '<div class="success">‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!</div>';
        } else {
            document.getElementById('notification-test-result').innerHTML = '<div class="error">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ: ' + JSON.stringify(result) + '</div>';
        }
    })
    .catch(error => {
        log('Notification error: ' + error.toString());
        document.getElementById('notification-test-result').innerHTML = '<div class="error">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: ' + error.toString() + '</div>';
    });
}

function testBalanceSync() {
    log('Testing balance synchronization...');
    document.getElementById('balance-test-result').innerHTML = '<div class="info">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏...</div>';
    
    var testData = {
        action: 'updateBalance',
        username: '@test_user',
        strategy: 'standard',
        balance: 1500.00
    };

    fetch(SCRIPT_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(testData)
    })
    .then(response => {
        log('Balance sync response status: ' + response.status);
        return response.json();
    })
    .then(result => {
        log('Balance sync result: ' + JSON.stringify(result));
        if (result.success) {
            document.getElementById('balance-test-result').innerHTML = '<div class="success">‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ —É—Å–ø–µ—à–Ω–∞!</div>';
        } else {
            document.getElementById('balance-test-result').innerHTML = '<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏: ' + JSON.stringify(result) + '</div>';
        }
    })
    .catch(error => {
        log('Balance sync error: ' + error.toString());
        document.getElementById('balance-test-result').innerHTML = '<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –±–∞–ª–∞–Ω—Å–∞: ' + error.toString() + '</div>';
    });
}

// –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä—è–º–æ–≥–æ Telegram API
function testDirectTelegram() {
    log('Testing direct Telegram API...');
    
    var message = 'üß™ –¢–µ—Å—Ç –ø—Ä—è–º–æ–≥–æ API –æ—Ç Debug Tool';
    var data = {
        chat_id: CHAT_ID,
        text: message
    };

    fetch('https://api.telegram.org/bot' + BOT_TOKEN + '/sendMessage', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    })
    .then(response => {
        log('Direct Telegram response status: ' + response.status);
        return response.json();
    })
    .then(result => {
        log('Direct Telegram result: ' + JSON.stringify(result));
        if (result.ok) {
            alert('‚úÖ –ü—Ä—è–º–æ–µ Telegram API —Ä–∞–±–æ—Ç–∞–µ—Ç!');
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞ Telegram API: ' + result.description);
        }
    })
    .catch(error => {
        log('Direct Telegram error: ' + error.toString());
        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ Telegram API: ' + error.toString());
    });
}

// –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.addEventListener('load', init);
</script>

<div style="margin-top: 30px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
    <h4>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã:</h4>
    <button onclick="testDirectTelegram()">–¢–µ—Å—Ç –ø—Ä—è–º–æ–≥–æ Telegram API</button>
    <button onclick="window.open('https://script.google.com/macros/s/AKfycby63juAkVub8oT0LZT2K8bpQ8l4FzfOTPWdeEYRSvTQXqiO5mfCj3Qz07r-4Cx276WePQ/exec', '_blank')">–û—Ç–∫—Ä—ã—Ç—å Google Apps Script</button>
</div>

</body>
</html>
