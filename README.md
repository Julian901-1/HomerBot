# T-Bank Automation Service

‚ö†Ô∏è –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –º–µ–∂–¥—É –¢‚Äë–ë–∞–Ω–∫–æ–º –∏ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–æ–º —á–µ—Ä–µ–∑ Puppeteer. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –±–∞–Ω–∫–æ–≤, –ø–æ—ç—Ç–æ–º—É –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –µ–≥–æ —Ç–æ–ª—å–∫–æ –≤ –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö –∏ –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–∏—Å–∫.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é —Å—Ä–µ–¥—Å—Ç–≤ —Å –¥–µ–±–µ—Ç–æ–≤–æ–≥–æ —Å—á—ë—Ç–∞ –¢-–ë–∞–Ω–∫–∞ –Ω–∞ –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Å—á—ë—Ç –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–∞ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º —Å—Ä–µ–¥—Å—Ç–≤ –≤ –Ω—É–∂–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ —Ç–æ—Ç –∂–µ —Å—á—ë—Ç.
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ—á–Ω–æ–π –∏ —É—Ç—Ä–µ–Ω–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ —Å —Ä–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏–µ–π ¬±20 –º–∏–Ω—É—Ç.
- –û–±—Ä–∞–±–æ—Ç–∫–∞ SMS-–∫–æ–¥–æ–≤ –∏–∑ MacroDroid, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

## üß∞ –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Å—Ç–µ–∫
- Node.js + Express ‚Äî REST API –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä.
- Puppeteer Extra + Stealth plugin ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–æ–º —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
- moment-timezone ‚Äî —Ä–∞—Å—á—ë—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è —Å —É—á—ë—Ç–æ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω—ã.
- Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –¥–µ–ø–ª–æ–π –Ω–∞ Render.

## üîë –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Render)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
| --- | --- |
| `PORT` | –ü–æ—Ä—Ç —Å–µ—Ä–≤–∏—Å–∞ (—á–∞—â–µ –≤—Å–µ–≥–æ `3000`). |
| `PUPPETEER_HEADLESS` | `true`, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä —Ä–∞–±–æ—Ç–∞–ª –±–µ–∑ GUI. |
| `PUPPETEER_SKIP_CHROMIUM_DOWNLOAD` | `true`, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–π Chrome. |
| `PUPPETEER_EXECUTABLE_PATH` | –ü—É—Ç—å –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É Chrome (`/usr/bin/google-chrome` –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ Render). |
| `TBANK_LOGIN_URL` | URL —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞ –≤ –¢‚Äë–ë–∞–Ω–∫. |
| `ENCRYPTION_SECRET_KEY` | 32-—Å–∏–º–≤–æ–ª—å–Ω—ã–π –∫–ª—é—á AES –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. |
| `SCHEDULER_USERNAME` | –ù–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ API-–≤—ã–∑–æ–≤–∞—Ö –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞. |
| `SCHEDULER_EVENING_HOUR` / `SCHEDULER_MORNING_HOUR` | –ß–∞—Å—ã –∑–∞–ø—É—Å–∫–æ–≤ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ (`19`, `07` –∏ —Ç.–ø.). |
| `SCHEDULER_BASE_URL` | –ë–∞–∑–æ–≤—ã–π URL —Å–µ—Ä–≤–∏—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://example.onrender.com`). |
| `SCHEDULER_TIMEZONE` | –¢–∞–π–º–∑–æ–Ω–∞ (`Europe/Moscow` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é). |
| `TBANK_SOURCE_ACCOUNT_ID` | ID —Å—á—ë—Ç–∞ –¢‚Äë–ë–∞–Ω–∫–∞, –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º—ã–π –≤ —Ñ–æ—Ä–º—É ¬´–º–µ–∂–¥—É —Å–≤–æ–∏–º–∏ —Å—á–µ—Ç–∞–º–∏¬ª. |
| `TBANK_SBP_ACCOUNT_ID` | ID —Å—á—ë—Ç–∞ –¢‚Äë–ë–∞–Ω–∫–∞, —Å –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –°–ë–ü-–ø–µ—Ä–µ–≤–æ–¥. |
| `ALFA_REQUIRED_SAVING_ACCOUNT_ID` | ID –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å—á—ë—Ç–∞ –≤ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–µ, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è. |
| `FIXED_TBANK_PHONE` | –¢–µ–ª–µ—Ñ–æ–Ω –¢‚Äë–ë–∞–Ω–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —É—Ç—Ä–µ–Ω–Ω–∏–º —Å—Ü–µ–Ω–∞—Ä–∏–µ–º (—Ñ–æ—Ä–º–∞—Ç `+79990000000`). |
| `FIXED_ALFA_PHONE` | –¢–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—É—á–∞—Ç–µ–ª—è –≤ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –°–ë–ü). |
| `FIXED_ALFA_CARD` | –ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤. |
| `FIXED_ALFA_SAVING_ACCOUNT_ID` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π ID –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å—á—ë—Ç–∞ –ê–ª—å—Ñ—ã (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–æ–≥–∏–∫–æ–π). |

## üì± –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MacroDroid

1. **–ü–µ—Ä–µ—Å—ã–ª–∫–∞ SMS –∏–∑ MacroDroid.**  
   - –î–ª—è –∫–æ–¥–æ–≤ –¢‚Äë–ë–∞–Ω–∫–∞: `POST https://<–≤–∞—à-–¥–æ–º–µ–Ω>/api/auth/auto-sms`
     ```json
     {
       "username": "marulin",
       "message": "{sms_message}"
     }
     ```
   - –î–ª—è –∫–æ–¥–æ–≤ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫–∞: `POST https://<–≤–∞—à-–¥–æ–º–µ–Ω>/api/auth/auto-sms-alfa`
     ```json
     {
       "username": "marulin",
       "message": "{sms_message}"
     }
     ```
   –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Content-Type: application/json`.

2. **–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–¥–ª—è —Ç–µ—Å—Ç–∞).**  
   –û—Ç–ø—Ä–∞–≤—å—Ç–µ `POST /api/evening-transfer` –∏–ª–∏ `POST /api/morning-transfer`:
   ```json
   { "username": "marulin" }
   ```
   –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é.
   –°–µ—Ä–≤–µ—Ä –∑–∞—à–∏—Ñ—Ä—É–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –ø–∞—Ä–æ–ª—å —Å –ø–æ–º–æ—â—å—é `ENCRYPTION_SECRET_KEY`, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ö—Ä–∞–Ω–∏–ª–∏—Å—å –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ.

## üöÄ –ó–∞–ø—É—Å–∫ –Ω–∞ Render (Docker)
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: —É–∫–∞–∂–∏—Ç–µ Render –ø—É—Ç—å –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É `tbank-automation/` –∏ `Dockerfile`.
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Web Service, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω –∏ —Ç–∞—Ä–∏—Ñ (–ø–æ–¥–æ–π–¥—ë—Ç Free).
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **Environment** –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –≤—ã—à–µ.
4. –ù–∞–∂–º–∏—Ç–µ **Deploy** ‚Äî Render —Å–æ–±–µ—Ä—ë—Ç –æ–±—Ä–∞–∑ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–∏—Å.
5. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `SIMPLE-SCHEDULER` –æ–±—è–∑–∞–Ω –≤—ã–≤–µ—Å—Ç–∏ –±–ª–∏–∂–∞–π—à–∏–µ –∑–∞–ø—É—Å–∫–∏ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## üí° –°–æ–≤–µ—Ç—ã
- –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏ –º–æ–∂–Ω–æ –≤—ã—Å—Ç–∞–≤–∏—Ç—å `PUPPETEER_HEADLESS=false` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å `npm start`.
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ.
- –•—Ä–∞–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –≤ –ø–∞–Ω–µ–ª–∏ Render; –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
