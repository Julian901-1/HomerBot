<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Homer Invest — MiniApp</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root { color-scheme: light dark; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Inter, Roboto, Arial, sans-serif; background:#0d0f14; color:#e9eaee; }
    a { color: inherit; }
    .wrap { max-width: 820px; margin: 0 auto; padding: 12px 16px 80px; }

    /* AppBar + Tabs */
    .appbar { display:flex; align-items:center; justify-content:space-between; gap:10px; position:sticky; top:0; background:inherit; padding:8px 0 10px; z-index:5; }
    .brand { font-weight:800; letter-spacing:.2px; opacity:.92; }
    .tabs { display:flex; gap:8px; flex-wrap:wrap; }
    .tab { padding:8px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); opacity:.8; cursor:pointer; font-weight:700; }
    .tab.active { background: rgba(255,255,255,.08); opacity:1; }

    /* Pages */
    .page { display:none; }
    .page.active { display:block; }

    /* Cards, blocks */
    .card { background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
            border-radius:16px; padding:16px; box-shadow:0 12px 34px rgba(0,0,0,.25); margin:12px 0; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .col { display:flex; flex-direction:column; gap:10px; }

    /* Balance */
    .balanceBlock { display:grid; gap:8px; }
    .label { opacity:.7; font-size:13px; }
    .balance { font-size:40px; font-weight:900; letter-spacing:.3px; font-variant-numeric: tabular-nums; }
    .muted { opacity:.75; }

    /* Buttons */
    .btn { padding:12px 14px; border:0; border-radius:12px; font-weight:800; cursor:pointer; font-size:16px; }
    .btn:disabled { opacity:.6; cursor:default; }
    .btn-primary { background:#4c8bf5; color:#fff; }
    .btn-secondary { background:#1b1e26; color:#fff; border:1px solid rgba(255,255,255,.15); }
    .btn-ghost { background:transparent; border:1px dashed rgba(255,255,255,.25); color:#fff; }

    /* Strategy cards */
    .strategyRow { display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    .strategy { padding:14px; border-radius:14px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.05); }
    .strategy h4 { margin:0 0 6px; font-size:16px; }
    .chip { display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.15); font-weight:700; font-size:12px; opacity:.9; }
    .list { margin:8px 0 12px; padding-left:18px; opacity:.9; }
    .list li { margin:4px 0; }

    /* Income + sparkline */
    .income { display:flex; gap:14px; align-items:center; flex-wrap:wrap; }
    .incomeItem { background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.1); padding:10px 12px; border-radius:12px; }
    .spark { width:120px; height:40px; opacity:.6; }

    /* Status pill */
    .status { margin-top:8px; display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px; font-weight:700; }
    .status.warn { background:#6a4d00; color:#fff; }
    .status.ok { background:#0e4f2a; color:#d8ffe9; }

    /* Back */
    .back { display:inline-flex; gap:6px; align-items:center; margin:4px 0 8px; cursor:pointer; opacity:.85; font-weight:700; }

    /* Inputs (placeholders) */
    .field { display:flex; flex-direction:column; gap:4px; }
    .input { background:#11141b; border:1px solid rgba(255,255,255,.15); border-radius:10px; padding:10px 12px; color:#fff; }

    /* Floating support */
    .support { position:fixed; right:16px; bottom:16px; width:52px; height:52px; border-radius:50%; background:#4c8bf5; color:#fff;
               display:grid; place-items:center; font-weight:900; font-size:20px; border:0; box-shadow:0 10px 28px rgba(76,139,245,.45); z-index:9; }

    /* Popup */
    .popup { position:fixed; left:50%; bottom:24px; transform:translateX(-50%); background:rgba(20,20,20,.92); color:#fff; padding:12px 14px; border-radius:12px; font-size:14px; z-index:9999; box-shadow:0 12px 32px rgba(0,0,0,.35); white-space:pre-line; }

    @media (max-width:720px){
      .strategyRow{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="appbar">
      <div class="brand">Homer Invest</div>
      <div class="tabs">
        <div class="tab active" data-page="home">Главная</div>
        <div class="tab" data-page="strategy">Стратегия</div>
        <div class="tab" data-page="deposit">Депозит</div>
        <div class="tab" data-page="withdraw">Вывод</div>
        <div class="tab" data-page="history">История</div>
        <div class="tab" data-page="profile">Профиль</div>
      </div>
    </div>

    <!-- Home -->
    <section id="page-home" class="page active">
      <div class="card balanceBlock">
        <div class="label" id="hello">Добро пожаловать</div>
        <div class="balance" id="balance">12 345.67</div>
        <div class="muted">Инвестировано: <span id="invested">0.00</span></div>
        <div class="row">
          <button class="btn btn-primary" data-page="deposit">Депозит</button>
          <button class="btn btn-secondary" data-page="withdraw">Вывод</button>
          <button class="btn btn-ghost" id="ctaExplain">Как считаются проценты?</button>
        </div>
        <div id="syncStatus" class="status warn">Подключение…</div>
      </div>

      <div class="card">
        <div class="label">Стратегии</div>
        <div class="strategyRow">
          <div class="strategy">
            <h4>Гибкая 16%</h4>
            <span class="chip">Вывод в любое время</span>
            <ul class="list">
              <li>Начисление ежесекундно</li>
              <li>Капитализация ежемесячно</li>
            </ul>
            <button class="btn btn-secondary" data-page="strategy" data-strategy="flex16">Инвестировать</button>
          </div>
          <div class="strategy">
            <h4>30 дней — 17%</h4>
            <span class="chip">Локап 30 дней</span>
            <ul class="list">
              <li>Досрочный вывод — без % текущего периода</li>
              <li>Автопролонгация — опционально</li>
            </ul>
            <button class="btn btn-secondary" data-page="strategy" data-strategy="30d17">Инвестировать</button>
          </div>
          <div class="strategy">
            <h4>90 дней — 18%</h4>
            <span class="chip">Локап 90 дней</span>
            <ul class="list">
              <li>Досрочный вывод — теряются % текущего периода</li>
              <li>Автопролонгация — опционально</li>
            </ul>
            <button class="btn btn-secondary" data-page="strategy" data-strategy="90d18">Инвестировать</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="label">Доходность</div>
        <div class="income">
          <div class="incomeItem">Сегодня: <b id="incToday">+0.00</b></div>
          <div class="incomeItem">Месяц: <b id="incMonth">+0.00</b></div>
          <svg class="spark" viewBox="0 0 120 40" preserveAspectRatio="none">
            <polyline fill="none" stroke="currentColor" stroke-width="2"
              points="0,30 15,26 30,28 45,22 60,18 75,14 90,16 105,10 120,8" />
          </svg>
        </div>
      </div>
    </section>

    <!-- Strategy details -->
    <section id="page-strategy" class="page">
      <div class="back" data-page="home">← К главной</div>
      <div class="card">
        <h3 id="strTitle">Стратегия</h3>
        <div class="label">Условия</div>
        <ul class="list" id="strRules">
          <li>Локап: —</li>
          <li>Начисление: ежесекундно, капитализация ежемесячно</li>
          <li>Досрочный вывод: —</li>
        </ul>
        <div class="label">Калькулятор (заглушка)</div>
        <div class="row">
          <div class="field" style="flex:1 1 220px;">
            <span class="label">Сумма</span>
            <input class="input" type="number" placeholder="Введите сумму…" id="calcAmount"/>
          </div>
          <div class="field" style="flex:1 1 220px;">
            <span class="label">Срок (дней)</span>
            <input class="input" type="number" placeholder="Напр. 30" id="calcDays"/>
          </div>
        </div>
        <div class="row">
          <label><input type="checkbox" id="autoRoll"/> Автопролонгация</label>
          <label><input type="checkbox" id="riskAck"/> Понимаю условия</label>
        </div>
        <div class="row">
          <button class="btn btn-primary" id="btnInvest">Инвестировать</button>
          <button class="btn btn-secondary" id="btnExample">Показать пример расчёта</button>
        </div>
      </div>
    </section>

    <!-- Deposit -->
    <section id="page-deposit" class="page">
      <div class="back" data-page="home">← К главной</div>
      <div class="card">
        <div class="label">Депозит — шаг 1/3</div>
        <div class="row">
          <button class="btn btn-secondary" data-dev="todo">Крипто (TON/USDT)</button>
          <button class="btn btn-secondary" data-dev="todo">Банковская карта</button>
          <button class="btn btn-primary" data-dev="todo">P2P (реком.)</button>
        </div>
        <div class="muted">Все методы, кроме P2P, сейчас — «в разработке».</div>
      </div>
      <div class="card">
        <div class="label">Сумма — шаг 2/3</div>
        <input class="input" type="number" placeholder="Минимум 100 ₽" />
      </div>
      <div class="card">
        <div class="label">Подтверждение — шаг 3/3</div>
        <button class="btn btn-primary" data-dev="todo">Подтвердить</button>
      </div>
    </section>

    <!-- Withdraw -->
    <section id="page-withdraw" class="page">
      <div class="back" data-page="home">← К главной</div>
      <div class="card">
        <div class="label">Вывод — шаг 1/3</div>
        <div class="muted">Источник средств: <b>Инвестиционный баланс</b></div>
      </div>
      <div class="card">
        <div class="label">Сумма — шаг 2/3</div>
        <input class="input" type="number" placeholder="Доступно: 0.00" />
      </div>
      <div class="card">
        <div class="label">Реквизиты — шаг 3/3</div>
        <input class="input" placeholder="Номер телефона для СБП" />
        <button class="btn btn-primary" data-dev="todo">Подтвердить вывод</button>
      </div>
    </section>

    <!-- History -->
    <section id="page-history" class="page">
      <div class="back" data-page="home">← К главной</div>
      <div class="card">
        <div class="row">
          <button class="btn btn-secondary" data-filter="all">Все</button>
          <button class="btn btn-secondary" data-filter="dep">Депозиты</button>
          <button class="btn btn-secondary" data-filter="wd">Выводы</button>
          <button class="btn btn-secondary" data-filter="int">Начисления</button>
        </div>
        <div class="col" id="historyList">
          <!-- Мок-записи -->
          <div class="card"><b>Депозит</b> · 10 000.00 · 2025-09-15 · <span class="chip">completed</span> · #a1b2</div>
          <div class="card"><b>Начисление</b> · 123.45 · 2025-09-30 · <span class="chip">posted</span> · #c3d4</div>
          <div class="card"><b>Вывод</b> · 5 000.00 · 2025-10-02 · <span class="chip">pending</span> · #e5f6</div>
        </div>
      </div>
    </section>

    <!-- Profile/Settings -->
    <section id="page-profile" class="page">
      <div class="back" data-page="home">← К главной</div>
      <div class="card">
        <div class="label">Настройки</div>
        <div class="row">
          <button class="btn btn-secondary" data-dev="todo">Валюта интерфейса (RUB)</button>
          <button class="btn btn-secondary" data-dev="todo">Уведомления</button>
          <button class="btn btn-secondary" data-dev="todo">Безопасность</button>
        </div>
        <div class="row">
          <a class="btn btn-ghost" href="https://docs.google.com/document/d/1Rv3N2iTgwHXhTkSgv-BwKLrekVpZtoGfU_ct2lDw00g" target="_blank" rel="noopener">Условия пользования</a>
        </div>
      </div>
    </section>

    <!-- Support floating -->
    <button class="support" id="supportBtn">?</button>
  </div>

  <!-- Bottom-sheet: formula -->
  <div id="modal" style="display:none; position:fixed; left:0; right:0; bottom:0; background:#0f1219; border-top:1px solid rgba(255,255,255,.12); padding:16px; border-top-left-radius:16px; border-top-right-radius:16px; box-shadow:0 -20px 60px rgba(0,0,0,.5); z-index:99;">
    <div class="row" style="justify-content:space-between; align-items:center;">
      <div style="font-weight:800;">Как считаются проценты?</div>
      <button class="btn btn-ghost" id="modalClose">Закрыть</button>
    </div>
    <div class="muted" style="margin-top:8px">
      Используем ежедневное начисление и ежемесячную капитализацию. Примеры и точные формулы появятся здесь.
    </div>
  </div>

  <script>
    // ---------- Helpers ----------
    function $(sel){ return document.querySelector(sel); }
    function $all(sel){ return Array.from(document.querySelectorAll(sel)); }
    function showPopup(text, ms=2200){
      const el = document.createElement('div'); el.className='popup'; el.textContent=text; document.body.appendChild(el);
      setTimeout(()=>{ el.style.transition='opacity .25s'; el.style.opacity='0'; setTimeout(()=>el.remove(), 260); }, ms);
    }
    function openPage(id){
      $all('.page').forEach(p=>p.classList.remove('active'));
      $('#page-'+id).classList.add('active');
      $all('.tab').forEach(t=>t.classList.toggle('active', t.dataset.page===id));
    }
    function todo(){ showPopup('Функция в разработке'); }

    // ---------- Init ----------
    (function initTWA(){
      try{ Telegram.WebApp.expand(); }catch(e){}
    })();

    (function initUI(){
      // Tabs
      $all('.tab').forEach(t=> t.addEventListener('click', ()=> openPage(t.dataset.page)));
      // Link-like buttons
      $all('[data-page]').forEach(b=> b.addEventListener('click', ()=> openPage(b.dataset.page)));
      // Dev placeholders
      $all('[data-dev="todo"]').forEach(b=> b.addEventListener('click', todo));
      // Support
      $('#supportBtn').addEventListener('click', todo);
      // Modal
      $('#ctaExplain').addEventListener('click', ()=> $('#modal').style.display='block');
      $('#modalClose').addEventListener('click', ()=> $('#modal').style.display='none');

      // Greeting (MSK)
      try{
        const user = (Telegram.WebApp.initDataUnsafe?.user?.username) || 'пользователь';
        const nowMsk = new Date(new Date().toLocaleString('en-US',{timeZone:'Europe/Moscow'}));
        const h = nowMsk.getHours();
        let hello = 'Добрый день'; if (h>=22 || h<6) hello='Доброй ночи'; else if (h>=17) hello='Добрый вечер';
        $('#hello').textContent = `${hello}, ${user}`;
      }catch{}

      // Status pill imitation
      const st = $('#syncStatus');
      st.classList.remove('ok'); st.classList.add('warn'); st.textContent='Подключение…';
      setTimeout(()=>{ st.classList.remove('warn'); st.classList.add('ok'); st.textContent='Синхронизировано'; }, 800);

      // Strategy details defaults (placeholder mapping)
      const strategyButtons = $all('.strategy button[data-page="strategy"]');
      strategyButtons.forEach(b=>{
        b.addEventListener('click', ()=>{
          const id = b.dataset.strategy;
          if (id==='flex16'){ $('#strTitle').textContent='Гибкая 16% годовых';
            $('#strRules').innerHTML='<li>Локап: отсутствует</li><li>Начисление: ежесекундно, капитализация ежемесячно</li><li>Досрочный вывод: без штрафа</li>'; }
          if (id==='30d17'){ $('#strTitle').textContent='30 дней — 17% годовых';
            $('#strRules').innerHTML='<li>Локап: 30 дней</li><li>Начисление: ежесекундно, капитализация ежемесячно</li><li>Досрочный вывод: без % текущего периода</li>'; }
          if (id==='90d18'){ $('#strTitle').textContent='90 дней — 18% годовых';
            $('#strRules').innerHTML='<li>Локап: 90 дней</li><li>Начисление: ежесекундно, капитализация ежемесячно</li><li>Досрочный вывод: теряются % текущего периода</li>'; }
        });
      });

      // Strategy CTA placeholders
      $('#btnInvest').addEventListener('click', todo);
      $('#btnExample').addEventListener('click', todo);
    })();
  </script>
</body>
</html>
