<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>HomerBot ‚Äî –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –ö–æ—à–µ–ª—ë–∫</title>
  <style>
    :root { 
      color-scheme: light dark;
      --bg-primary: #0a0b0f;
      --bg-secondary: rgba(255,255,255,0.04);
      --bg-card: rgba(255,255,255,0.06);
      --border: rgba(255,255,255,0.08);
      --text-primary: #e8eaed;
      --text-secondary: rgba(232,234,237,0.7);
      --text-muted: rgba(232,234,237,0.5);
      --accent: #4c8bf5;
      --accent-hover: #5a95f7;
      --success: #34d399;
      --warning: #fbbf24;
      --error: #f87171;
      --glass-bg: rgba(255,255,255,0.03);
      --glass-border: rgba(255,255,255,0.1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif; 
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.5;
      overflow-x: hidden;
    }

    .app-container {
      max-width: 430px;
      margin: 0 auto;
      min-height: 100vh;
      background: var(--bg-primary);
      position: relative;
    }

    /* Header */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--bg-primary);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 12px 20px;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .profile-btn {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .profile-btn:hover {
      background: var(--glass-bg);
      transform: scale(1.05);
    }

    /* Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 430px;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      border-top: 1px solid var(--border);
      padding: 12px 20px 20px;
      z-index: 100;
    }

    .nav-items {
      display: flex;
      justify-content: space-around;
      align-items: center;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 12px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      opacity: 0.6;
    }

    .nav-item.active {
      opacity: 1;
      background: var(--glass-bg);
    }

    .nav-item:hover {
      opacity: 1;
      transform: translateY(-2px);
    }

    .nav-icon {
      width: 24px;
      height: 24px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
    }

    .nav-label {
      font-size: 11px;
      font-weight: 500;
    }

    /* Pages */
    .page {
      display: none;
      padding: 20px 20px 100px;
      min-height: calc(100vh - 72px);
    }

    .page.active {
      display: block;
    }

    /* Cards */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 16px;
      backdrop-filter: blur(10px);
    }

    .glass-card {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 16px;
      backdrop-filter: blur(20px);
    }

    /* Balance Section */
    .balance-section {
      text-align: center;
      margin-bottom: 24px;
    }

    .balance-label {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .balance-main {
      font-size: 42px;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 8px;
      font-variant-numeric: tabular-nums;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .balance-currency {
      font-size: 16px;
      color: var(--text-muted);
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      position: relative;
    }

    .currency-arrow {
      font-size: 10px;
      opacity: 0.7;
    }

    .balance-stats {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border);
    }

    .balance-stat {
      text-align: center;
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 16px;
      font-weight: 700;
    }

    .stat-positive { color: var(--success); }
    .stat-warning { color: var(--warning); }

    .next-accrual {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      font-size: 14px;
      color: var(--text-secondary);
      text-align: center;
    }

    .next-accrual-amount {
      color: var(--success);
      font-weight: 600;
    }

    /* Buttons */
    .btn-group {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
    }

    .btn {
      flex: 1;
      padding: 16px 24px;
      border-radius: 16px;
      border: none;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: var(--glass-bg);
      border: 1px solid var(--border);
      color: var(--text-primary);
    }

    .btn-secondary:hover {
      background: var(--bg-card);
      transform: translateY(-2px);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    /* Strategy Cards */
    .strategies-section h2 {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 16px;
      color: var(--text-primary);
    }

    .strategy-cards {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .strategy-card {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .strategy-card:hover {
      background: var(--bg-card);
      transform: translateY(-2px);
    }

    .strategy-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .strategy-name {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .strategy-rate {
      font-size: 24px;
      font-weight: 800;
      color: var(--accent);
    }

    .strategy-description {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 16px;
    }

    .strategy-features {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .feature-tag {
      padding: 4px 8px;
      background: var(--glass-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 12px;
      color: var(--text-secondary);
    }

/* Status (slide-in/out) */
.status {
  position: fixed;
  top: 80px;
  right: 20px;
  padding: 8px 12px;
  background: var(--glass-bg);
  border: 1px solid var(--border);
  border-radius: 12px;
  font-size: 12px;
  backdrop-filter: blur(10px);
  z-index: 90;
  transform: translateX(130%); /* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–Ω–µ —ç–∫—Ä–∞–Ω–∞ */
  opacity: 0;
  transition: transform .35s ease, opacity .35s ease;
  pointer-events: none;
}
.status.show {
  transform: translateX(0);
  opacity: 1;
}

    .status.loading { color: var(--warning); }
    .status.synced { color: var(--success); }
    .status.error { color: var(--error); }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px);
      z-index: 1000;
      display: none;
      align-items: flex-end;
      justify-content: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-primary);
      border-radius: 24px 24px 0 0;
      width: 100%;
      max-width: 430px;
      max-height: 90vh;
      overflow-y: auto;
      padding: 24px;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
    }

    .close-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: var(--glass-bg);
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Deposit Methods */
    .method-cards {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .method-card {
      background: var(--glass-bg);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .method-card.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .method-card:not(.disabled):hover {
      background: var(--bg-card);
      transform: translateY(-2px);
    }

    .method-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .method-info h3 {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .method-info p {
      font-size: 14px;
      color: var(--text-secondary);
    }

    /* Popup */
    .popup {
      position: fixed;
      left: 50%;
      bottom: 120px;
      transform: translateX(-50%);
      background: rgba(20,20,20,0.95);
      color: white;
      padding: 16px 20px;
      border-radius: 16px;
      font-size: 14px;
      z-index: 9999;
      max-width: 90vw;
      text-align: center;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
      white-space: pre-line;
    }

    /* Responsive */
    @media (max-width: 375px) {
      .balance-main { font-size: 36px; }
      .btn { padding: 14px 20px; font-size: 15px; }
      .strategy-rate { font-size: 20px; }
    }

    /* Loading skeleton */
    .skeleton {
      background: linear-gradient(90deg, var(--glass-bg) 25%, var(--bg-card) 50%, var(--glass-bg) 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Support button */
    .support-btn {
      position: fixed;
      bottom: 120px;
      right: 20px;
      width: 56px;
      height: 56px;
      background: #6b7280;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 90;
      transition: all 0.2s ease;
    }

    .support-btn:hover {
      transform: scale(1.1);
    }

    /* Development notice */
    .dev-notice {
      background: var(--warning);
      color: #000;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-left: 8px;
    }

    /* Math formula */
    .math-formula {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0;
      font-size: 16px;
      font-weight: 500;
    }

    .formula-fraction {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0 8px;
    }

    .formula-numerator {
      padding-bottom: 4px;
      border-bottom: 2px solid var(--text-primary);
    }

    .formula-denominator {
      padding-top: 4px;
    }

    .formula-row {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Toggle switch */
    .toggle-container {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 12px 0;
    }

    .toggle-switch {
      position: relative;
      width: 48px;
      height: 24px;
      background: var(--glass-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle-switch.active {
      background: var(--accent);
    }

    .toggle-slider {
      position: absolute;
      top: 2px;
      left: 2px;
      width: 18px;
      height: 18px;
      background: white;
      border-radius: 50%;
      transition: transform 0.3s;
    }

    .toggle-switch.active .toggle-slider {
      transform: translateX(24px);
    }

    /* Quick amount buttons */
    .quick-amounts {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 16px;
    }

    .quick-amount-btn {
      padding: 12px;
      background: var(--glass-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quick-amount-btn:hover {
      background: var(--bg-card);
      transform: translateY(-1px);
    }

    /* Input with copy */
    .input-with-copy {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .input-field {
      flex: 1;
      padding: 12px;
      background: var(--glass-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 16px;
    }

    .copy-btn {
      width: 40px;
      height: 40px;
      background: var(--glass-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .copy-btn:hover {
      background: var(--bg-card);
    }

    .copy-icon {
      width: 18px;
      height: 18px;
      stroke: var(--text-secondary);
    }

    /* Filter chips */
    .filter-chips {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    .filter-chip {
      padding: 8px 16px;
      background: var(--glass-bg);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-chip.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .filter-chip:hover {
      transform: translateY(-1px);
    }

    /* Dropdown */
    .dropdown {
      position: relative;
      margin-bottom: 16px;
    }

    .dropdown-select {
      width: 100%;
      padding: 12px;
      background: var(--glass-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 16px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .dropdown-arrow {
      font-size: 12px;
      transition: transform 0.2s;
    }

    .dropdown.open .dropdown-arrow {
      transform: rotate(180deg);
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      margin-top: 4px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      display: none;
      z-index: 10;
    }

    .dropdown.open .dropdown-menu {
      display: block;
    }

    .dropdown-item {
      padding: 12px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .dropdown-item:hover {
      background: var(--glass-bg);
    }

    /* Currency dropdown */
    .currency-dropdown {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-top: 8px;
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 8px;
      display: none;
      z-index: 10;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }

    .currency-dropdown.open {
      display: block;
    }

    .currency-option {
      padding: 8px 16px;
      cursor: pointer;
      border-radius: 8px;
      transition: background 0.2s;
    }

    .currency-option:hover {
      background: var(--glass-bg);
    }

    .currency-option.active {
      background: var(--accent);
      color: white;
    }

    /* Deposit form */
    .deposit-form {
      padding: 20px 0;
    }

    .deposit-form-label {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .amount-input {
      width: 100%;
      padding: 16px;
      background: var(--glass-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 24px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 16px;
    }

    .amount-limits {
      font-size: 12px;
      color: var(--text-muted);
      text-align: center;
      margin-bottom: 16px;
    }

    /* Graph placeholder */
    .graph-placeholder {
      height: 200px;
      background: var(--glass-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    .calculation-result {
      background: var(--glass-bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
    }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <div class="header">
      <div class="header-content">
        <div class="logo">HomerBot</div>
        <button class="profile-btn" onclick="openModal('profile')">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Status indicator -->
    <div id="status" class="status loading">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>

    <!-- Support button -->
    <button class="support-btn" onclick="showDevPopup('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">
      <svg class="nav-icon" viewBox="0 0 24 24" style="color: white;">
        <path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
      </svg>
    </button>

    <!-- Pages -->
    
    <!-- Home Page -->
    <div class="page active" id="pageHome">
      <!-- Balance Card -->
      <div class="card">
        <div class="balance-section">
          <div class="balance-label">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</div>
          <div class="balance-main">
            <span id="balanceValue">‚Äî</span>
            <div class="balance-currency" onclick="toggleCurrencyDropdown(event)">
              <span id="currentCurrency">RUB</span>
              <span class="currency-arrow">‚ñº</span>
              <div class="currency-dropdown" id="currencyDropdown">
                <div class="currency-option active" onclick="selectCurrency('RUB', event)">RUB</div>
                <div class="currency-option" onclick="selectCurrency('USD', event)">USD</div>
                <div class="currency-option" onclick="selectCurrency('EUR', event)">EUR</div>
              </div>
            </div>
          </div>
          
          <div class="balance-stats">
            <div class="balance-stat">
              <div class="stat-label">–°–≤–æ–±–æ–¥–Ω–æ</div>
              <div class="stat-value" id="freeBalance">‚Äî</div>
            </div>
            <div class="balance-stat">
              <div class="stat-label">–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ</div>
              <div class="stat-value stat-positive" id="investedBalance">‚Äî</div>
            </div>
            <div class="balance-stat">
              <div class="stat-label">–î–æ—Ö–æ–¥ —Å–µ–≥–æ–¥–Ω—è</div>
              <div class="stat-value stat-positive" id="todayIncome">+0.00</div>
            </div>
          </div>
          
          <div class="next-accrual">
            –ù–∞—á–∏—Å–ª–∏–º <span class="next-accrual-amount" id="nextAccrualAmount">125.50</span> <span id="nextAccrualDate">–∑–∞–≤—Ç—Ä–∞</span>
          </div>
        </div>
      </div>

      <!-- Action buttons -->
      <div class="btn-group">
        <button class="btn btn-primary" onclick="openModal('deposit')">
          <svg class="nav-icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
            <path d="M12 5v14m-7-7l7-7 7 7"/>
          </svg>
          –î–µ–ø–æ–∑–∏—Ç
        </button>
        <button class="btn btn-secondary" onclick="openModal('withdraw')">
          <svg class="nav-icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
            <path d="M12 19V5m-7 7l7 7 7-7"/>
          </svg>
          –í—ã–≤–æ–¥
        </button>
      </div>

      <!-- Strategies Section -->
      <div class="strategies-section">
        <h2>–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h2>
        
        <div class="strategy-cards">
          <div class="strategy-card" onclick="openModal('strategy1')">
            <div class="strategy-header">
              <div class="strategy-name">–ì–∏–±–∫–∞—è</div>
              <div class="strategy-rate">16%</div>
            </div>
            <div class="strategy-description">–í—ã–≤–æ–¥ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è –±–µ–∑ —à—Ç—Ä–∞—Ñ–∞</div>
            <div class="strategy-features">
              <span class="feature-tag">–ë–µ–∑ –∑–∞–º–æ—Ä–æ–∑–∫–∏</span>
              <span class="feature-tag">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≤–∫–ª–∞–¥—ã</span>
            </div>
          </div>

          <div class="strategy-card" onclick="openModal('strategy30')">
            <div class="strategy-header">
              <div class="strategy-name">30 –¥–Ω–µ–π</div>
              <div class="strategy-rate">17%</div>
            </div>
            <div class="strategy-description">–ó–∞–º–æ—Ä–æ–∑–∫–∞ 30 –¥–Ω–µ–π ‚Ä¢ –î–æ—Å—Ä–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ ‚Äî —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞</div>
            <div class="strategy-features">
              <span class="feature-tag">–ó–∞–º–æ—Ä–æ–∑–∫–∞ –Ω–∞ 30 –¥–Ω–µ–π</span>
              <span class="feature-tag">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≤–∫–ª–∞–¥—ã</span>
              <span class="feature-tag">–¶–§–ê</span>
            </div>
          </div>

          <div class="strategy-card" onclick="openModal('strategy90')">
            <div class="strategy-header">
              <div class="strategy-name">90 –¥–Ω–µ–π</div>
              <div class="strategy-rate">18%</div>
            </div>
            <div class="strategy-description">–ó–∞–º–æ—Ä–æ–∑–∫–∞ 90 –¥–Ω–µ–π ‚Ä¢ –î–æ—Å—Ä–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ ‚Äî —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞</div>
            <div class="strategy-features">
              <span class="feature-tag">–ó–∞–º–æ—Ä–æ–∑–∫–∞ –Ω–∞ 90 –¥–Ω–µ–π</span>
              <span class="feature-tag">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –≤–∫–ª–∞–¥—ã</span>
              <span class="feature-tag">–¶–§–ê</span>
              <span class="feature-tag">–ó–∞–π–º—ã</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick simulate button -->
      <div style="margin-top: 24px;">
        <button class="btn btn-secondary" id="simulateButton" onclick="simulateMonthlyInterest()" style="width: 100%;">
          <svg class="nav-icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12,6 12,12 16,14"/>
          </svg>
          –ò–º–∏—Ç–∞—Ü–∏—è –º–µ—Å—è—Ü–∞
        </button>
      </div>
    </div>

    <!-- Portfolio Page -->
    <div class="page" id="pagePortfolio">
      <div class="card">
        <h2 style="margin-bottom: 16px;">–ú–æ–π –ø–æ—Ä—Ç—Ñ–µ–ª—å</h2>
        <p style="color: var(--text-secondary); text-align: center; padding: 40px 20px;">
          –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è—Ö
        </p>
      </div>
    </div>

    <!-- Calculator Page -->
    <div class="page" id="pageCalculator">
      <div class="card">
        <h2 style="margin-bottom: 16px;">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏</h2>
        
        <div class="dropdown" id="strategyDropdown">
          <div class="dropdown-select" onclick="toggleDropdown('strategyDropdown')">
            <span id="selectedStrategy">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</span>
            <span class="dropdown-arrow">‚ñº</span>
          </div>
          <div class="dropdown-menu">
            <div class="dropdown-item" onclick="selectStrategy('–ì–∏–±–∫–∞—è 16%')">–ì–∏–±–∫–∞—è 16%</div>
            <div class="dropdown-item" onclick="selectStrategy('30 –¥–Ω–µ–π 17%')">30 –¥–Ω–µ–π 17%</div>
            <div class="dropdown-item" onclick="selectStrategy('90 –¥–Ω–µ–π 18%')">90 –¥–Ω–µ–π 18%</div>
          </div>
        </div>

        <div class="deposit-form-label">–°—É–º–º–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π</div>
        <input type="text" class="amount-input" id="calculatorAmount" placeholder="0" oninput="formatAmount(this); calculateProfit()">
        
        <div class="graph-placeholder">
          üìà –ì—Ä–∞—Ñ–∏–∫ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
        </div>
        
        <div class="calculation-result">
          <div style="color: var(--text-secondary); margin-bottom: 8px;">–†–∞—Å—á—ë—Ç –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏</div>
          <div id="calculationResult" style="font-size: 18px; font-weight: 700;">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏ –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É</div>
        </div>
      </div>
    </div>

    <!-- History Page -->
    <div class="page" id="pageHistory">
      <div class="card">
        <h2 style="margin-bottom: 16px;">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h2>
        
        <div class="filter-chips">
          <div class="filter-chip active" onclick="toggleFilter(this, 'all')">–í—Å–µ</div>
          <div class="filter-chip" onclick="toggleFilter(this, 'deposit')">–î–µ–ø–æ–∑–∏—Ç</div>
          <div class="filter-chip" onclick="toggleFilter(this, 'withdraw')">–í—ã–≤–æ–¥</div>
          <div class="filter-chip" onclick="toggleFilter(this, 'accrual')">–ù–∞—á–∏—Å–ª–µ–Ω–∏—è</div>
          <div class="filter-chip" onclick="toggleFilter(this, 'strategy')">–°—Ç—Ä–∞—Ç–µ–≥–∏–∏</div>
        </div>
        
        <p style="color: var(--text-secondary); text-align: center; padding: 40px 20px;">
          –ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤, –≤—ã–≤–æ–¥–æ–≤ –∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å
        </p>
      </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <div class="nav-items">
        <div class="nav-item active" onclick="openPage('home')">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9,22 9,12 15,12 15,22"/>
          </svg>
          <span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
        </div>
        
        <div class="nav-item" onclick="openPage('portfolio')">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <line x1="18" y1="20" x2="18" y2="10"/>
            <line x1="12" y1="20" x2="12" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="14"/>
          </svg>
          <span class="nav-label">–ü–æ—Ä—Ç—Ñ–µ–ª—å</span>
        </div>
        
        <div class="nav-item" onclick="openPage('calculator')">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <rect x="4" y="4" width="16" height="16" rx="2" ry="2"/>
            <rect x="9" y="9" width="6" height="6"/>
            <line x1="9" y1="1" x2="9" y2="4"/>
            <line x1="15" y1="1" x2="15" y2="4"/>
            <line x1="9" y1="20" x2="9" y2="23"/>
            <line x1="15" y1="20" x2="15" y2="23"/>
          </svg>
          <span class="nav-label">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
        </div>
        
        <div class="nav-item" onclick="openPage('history')">
          <svg class="nav-icon" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12,6 12,12 16,14"/>
          </svg>
          <span class="nav-label">–ò—Å—Ç–æ—Ä–∏—è</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  
  <!-- Deposit Modal -->
  <div class="modal-overlay" id="modalDeposit">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">–î–µ–ø–æ–∑–∏—Ç</h2>
        <button class="close-btn" onclick="closeModal('deposit')">
          <svg class="nav-icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      
      <div class="deposit-form-label">–ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä —Å—É–º–º—ã</div>
      <div class="quick-amounts">
        <button class="quick-amount-btn" onclick="setDepositAmount(1000)">1 000 ‚ÇΩ</button>
        <button class="quick-amount-btn" onclick="setDepositAmount(5000)">5 000 ‚ÇΩ</button>
        <button class="quick-amount-btn" onclick="setDepositAmount(10000)">10 000 ‚ÇΩ</button>
        <button class="quick-amount-btn" onclick="setDepositAmount(25000)">25 000 ‚ÇΩ</button>
        <button class="quick-amount-btn" onclick="setDepositAmount(50000)">50 000 ‚ÇΩ</button>
        <button class="quick-amount-btn" onclick="setDepositAmount(100000)">100 000 ‚ÇΩ</button>
      </div>
      
      <div class="deposit-form-label">–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É</div>
      <input type="text" class="amount-input" id="depositAmount" placeholder="0" oninput="formatAmount(this)">
      <div class="amount-limits">–õ–∏–º–∏—Ç—ã: min 100 ‚ÇΩ / max 10 000 000 ‚ÇΩ</div>
      
      <div class="method-cards">
        <div class="method-card disabled" onclick="showDevPopup('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">
          <div class="method-icon" style="background: #6b7280;">
            <svg class="nav-icon" viewBox="0 0 24 24" style="color: white;">
              <circle cx="12" cy="12" r="10"/>
              <path d="M8 14s1.5 2 4 2 4-2 4-2"/>
              <line x1="9" y1="9" x2="9.01" y2="9"/>
              <line x1="15" y1="9" x2="15.01" y2="9"/>
            </svg>
          </div>
          <div class="method-info">
            <h3>–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞ <span class="dev-notice">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</span></h3>
            <p>TON, USDT, –¥—Ä—É–≥–∏–µ –º–æ–Ω–µ—Ç—ã</p>
          </div>
        </div>

        <div class="method-card disabled" onclick="showDevPopup('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">
          <div class="method-icon" style="background: #6b7280;">
            <svg class="nav-icon" viewBox="0 0 24 24" style="color: white;">
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
              <line x1="1" y1="10" x2="23" y2="10"/>
            </svg>
          </div>
          <div class="method-info">
            <h3>–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞ <span class="dev-notice">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</span></h3>
            <p>Visa, Mastercard, –ú–ò–†</p>
          </div>
        </div>

        <div class="method-card" onclick="showP2PInfo()">
          <div class="method-icon">
            <svg class="nav-icon" viewBox="0 0 24 24" style="color: white;">
              <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
            </svg>
          </div>
          <div class="method-info">
            <h3>P2P –ø–µ—Ä–µ–≤–æ–¥—ã</h3>
            <p>–ü–µ—Ä–µ–≤–æ–¥—ã –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ ‚Ä¢ 0% –∫–æ–º–∏—Å—Å–∏—è</p>
          </div>
        </div>
      </div>
      
      <div style="margin-top: 20px;">
        <div class="input-with-copy">
          <input type="text" class="input-field" value="+7 916 643 54 94" readonly>
          <button class="copy-btn" onclick="copyToClipboard('+79166435494')">
            <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
          </button>
        </div>
        
        <div class="deposit-form-label">ID –æ–ø–µ—Ä–∞—Ü–∏–∏</div>
        <div class="input-with-copy">
          <input type="text" class="input-field" value="OP-2024-001234" readonly>
          <button class="copy-btn" onclick="copyToClipboard('OP-2024-001234')">
            <svg class="copy-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Withdraw Modal -->
  <div class="modal-overlay" id="modalWithdraw">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h2>
        <button class="close-btn" onclick="closeModal('withdraw')">
          <svg class="nav-icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      
      <div class="card" style="margin-bottom: 0;">
        <div style="text-align: center; padding: 40px 20px;">
          <p style="color: var(--text-secondary); margin-bottom: 16px;">–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –≤—ã–≤–æ–¥–∞</p>
          <div style="font-size: 28px; font-weight: 800; margin-bottom: 24px;" id="availableBalance">‚Äî</div>
          
          <div class="method-cards">
            <div class="method-card" onclick="showWithdrawForm()">
              <div class="method-icon">
                <svg class="nav-icon" viewBox="0 0 24 24" style="color: white;">
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                </svg>
              </div>
              <div class="method-info">
                <h3>–ë—ã—Å—Ç—Ä—ã–µ –ø–ª–∞—Ç–µ–∂–∏ (–°–ë–ü)</h3>
                <p>–í—ã–≤–æ–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Strategy Modal 1 (Flexible) -->
  <div class="modal-overlay" id="modalStrategy1">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">–ì–∏–±–∫–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è 16%</h2>
        <button class="close-btn" onclick="closeModal('strategy1')">
          <svg class="nav-icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      
      <div class="card" style="margin-bottom: 16px;">
        <h3 style="margin-bottom: 12px; color: var(--accent);">–£—Å–ª–æ–≤–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h3>
        <ul style="color: var(--text-secondary); line-height: 1.6;">
          <li>‚Ä¢ –ì–æ–¥–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞: <strong>16%</strong></li>
          <li>‚Ä¢ –ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è</li>
          <li>‚Ä¢ –í—ã–≤–æ–¥ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è –±–µ–∑ —à—Ç—Ä–∞—Ñ–∞</li>
          <li>‚Ä¢ –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤</li>
        </ul>
      </div>
<button class="btn btn-primary" onclick="openNewInvestment('16')" style="width: 100%;">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</button>
    </div>
  </div>

  <!-- Strategy Modal 30 days -->
  <div class="modal-overlay" id="modalStrategy30">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">–°—Ç—Ä–∞—Ç–µ–≥–∏—è 30 –¥–Ω–µ–π 17%</h2>
        <button class="close-btn" onclick="closeModal('strategy30')">
          <svg class="nav-icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      
      <div class="card" style="margin-bottom: 16px;">
        <h3 style="margin-bottom: 12px; color: var(--accent);">–£—Å–ª–æ–≤–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h3>
        <ul style="color: var(--text-secondary); line-height: 1.6;">
          <li>‚Ä¢ –ì–æ–¥–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞: <strong>17%</strong></li>
          <li>‚Ä¢ –ó–∞–º–æ—Ä–æ–∑–∫–∞ –Ω–∞ 30 –¥–Ω–µ–π</li>
          <li>‚Ä¢ –ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è</li>
          <li>‚Ä¢ –î–æ—Å—Ä–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ ‚Äî —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞</li>
          <li>‚Ä¢ –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤</li>
        </ul>
        
        <div class="toggle-container">
          <span>–ê–≤—Ç–æ–ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏—è</span>
          <div class="toggle-switch" onclick="toggleSwitch(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
      </div>
<button class="btn btn-primary" onclick="openNewInvestment('17')" style="width: 100%;">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</button>
    </div>
  </div>

  <!-- Strategy Modal 90 days -->
  <div class="modal-overlay" id="modalStrategy90">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">–°—Ç—Ä–∞—Ç–µ–≥–∏—è 90 –¥–Ω–µ–π 18%</h2>
        <button class="close-btn" onclick="closeModal('strategy90')">
          <svg class="nav-icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      
      <div class="card" style="margin-bottom: 16px;">
        <h3 style="margin-bottom: 12px; color: var(--accent);">–£—Å–ª–æ–≤–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h3>
        <ul style="color: var(--text-secondary); line-height: 1.6;">
          <li>‚Ä¢ –ì–æ–¥–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞: <strong>18%</strong></li>
          <li>‚Ä¢ –ó–∞–º–æ—Ä–æ–∑–∫–∞ –Ω–∞ 90 –¥–Ω–µ–π</li>
          <li>‚Ä¢ –ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è</li>
          <li>‚Ä¢ –î–æ—Å—Ä–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ ‚Äî —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–µ—Ä–∏–æ–¥–∞</li>
          <li>‚Ä¢ –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤</li>
        </ul>
        
        <div class="toggle-container">
          <span>–ê–≤—Ç–æ–ø—Ä–æ–ª–æ–Ω–≥–∞—Ü–∏—è</span>
          <div class="toggle-switch" onclick="toggleSwitch(this)">
            <div class="toggle-slider"></div>
          </div>
        </div>
      </div>
<button class="btn btn-primary" onclick="openNewInvestment('18')" style="width: 100%;">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Å—Ç—Ä–∞—Ç–µ–≥–∏—é</button>
    </div>
  </div>

<!-- New Investment Modal -->
<div class="modal-overlay" id="modalNewInvestment">
  <div class="modal">
    <div class="modal-header">
      <h2 class="modal-title">–û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏</h2>
      <button class="close-btn" onclick="closeModal('newInvestment')">
        <svg class="nav-icon" viewBox="0 0 24 24" style="width:20px;height:20px"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>

    <div class="deposit-form-label">–°—Ç—Ä–∞—Ç–µ–≥–∏—è</div>
    <div class="input-field" id="niStrategyReadonly" style="text-align:center;font-weight:700">‚Äî</div>

    <div class="deposit-form-label" style="margin-top:12px">–°—É–º–º–∞</div>
    <input type="text" class="amount-input" id="niAmount" placeholder="0" oninput="formatAmount(this)">

    <label style="display:flex;gap:8px;align-items:center;margin:10px 0 16px;">
      <input type="checkbox" id="niAgree"> <span>–° –ø—Ä–∞–≤–∏–ª–∞–º–∏ –æ–∑–Ω–∞–∫–æ–º–ª–µ–Ω</span>
    </label>

    <button class="btn btn-primary" style="width:100%" id="niConfirmBtn" disabled>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
  </div>
</div>

  
  <!-- Profile Modal -->
  <div class="modal-overlay" id="modalProfile">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">–ü—Ä–æ—Ñ–∏–ª—å</h2>
        <button class="close-btn" onclick="closeModal('profile')">
          <svg class="nav-icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      
      <div class="card" style="text-align: center; margin-bottom: 16px;">
        <div style="width: 80px; height: 80px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
          <svg class="nav-icon" viewBox="0 0 24 24" style="width: 32px; height: 32px; color: white;">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
        </div>
        <h3 id="profileUsername">‚Äî</h3>
        <p style="color: var(--text-secondary); font-size: 14px;">Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</p>
      </div>

      <div class="method-cards">
        <div class="method-card" onclick="showDevPopup('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">
          <div class="method-icon" style="background: #6b7280;">
            <svg class="nav-icon" viewBox="0 0 24 24" style="color: white;">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <circle cx="12" cy="16" r="1"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
          </div>
          <div class="method-info">
            <h3>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å <span class="dev-notice">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</span></h3>
            <p>2FA, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π, KYC</p>
          </div>
        </div>

        <div class="method-card" onclick="showDevPopup('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">
          <div class="method-icon" style="background: #6b7280;">
            <svg class="nav-icon" viewBox="0 0 24 24" style="color: white;">
              <path d="M14.828 14.828a4 4 0 0 1-5.656 0M9 10h.01M15 10h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 0 1-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
          </div>
          <div class="method-info">
            <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è <span class="dev-notice">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</span></h3>
            <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>
          </div>
        </div>

        <div class="method-card" onclick="showDevPopup('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">
          <div class="method-icon" style="background: #6b7280;">
            <svg class="nav-icon" viewBox="0 0 24 24" style="color: white;">
              <circle cx="12" cy="12" r="3"/>
              <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"/>
            </svg>
          </div>
          <div class="method-info">
            <h3>–Ø–∑—ã–∫ <span class="dev-notice">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</span></h3>
            <p>RU, ENG</p>
          </div>
        </div>

        <div class="method-card" onclick="openDocuments()">
          <div class="method-icon">
            <svg class="nav-icon" viewBox="0 0 24 24" style="color: white;">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10,9 9,9 8,9"/>
            </svg>
          </div>
          <div class="method-info">
            <h3>–î–æ–∫—É–º–µ–Ω—Ç—ã</h3>
            <p>–£—Å–ª–æ–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –ø–æ–ª–∏—Ç–∏–∫–∞</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const SCRIPT_URL = (window.scriptUrl || (window.SCRIPT_URL ?? 'https://script.google.com/macros/s/AKfycbzIAGI3xqdLJeOGHs8cgvLbMll5x82pc7clF_HTmQBQkc-5jbONBaq27NPZuaQAfuR_oA/exec'));

    // --- State ---
    window.username = null;
    window.isInitialized = false;
    window.serverBalance = 0;
    window.currentRate = 16;
    window.pendingRequest = false;
    window.currentCurrency = 'RUB';
    window.exchangeRates = { RUB: 1, USD: 0.011, EUR: 0.010 };
    window.__lastChosenStrategy = null; // '16' | '17' | '18'

    // --- UI helpers ---
    function fmtMoney(x) {
      const n = Number(x) || 0;
      return n.toLocaleString('ru-RU', {minimumFractionDigits: 2, maximumFractionDigits: 2});
    }

function openNewInvestment(rateCode){ // '16' | '17' | '18'
  window.__lastChosenStrategy = String(rateCode);
  const name = rateCode==='16' ? '–ì–∏–±–∫–∞—è 16%' : (rateCode==='17' ? '30 –¥–Ω–µ–π 17%' : '90 –¥–Ω–µ–π 18%');
  document.getElementById('niStrategyReadonly').textContent = name;
  document.getElementById('niAmount').value = '';
  document.getElementById('niAgree').checked = false;
  document.getElementById('niConfirmBtn').disabled = true;
  closeModal('strategy1'); closeModal('strategy30'); closeModal('strategy90');
  openModal('newInvestment');
  // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –≤–∫–ª–∞–¥–∫—É ¬´–ü–æ—Ä—Ç—Ñ–µ–ª—å¬ª
  openPage('portfolio');
}

document.getElementById('niAgree').addEventListener('change', function(){
  document.getElementById('niConfirmBtn').disabled = !this.checked;
});

document.getElementById('niConfirmBtn').addEventListener('click', async function(){
  const raw = document.getElementById('niAmount').value;
  const amount = parseInt(String(raw).replace(/[^\d]/g,'')) || 0;
  if (!window.__lastChosenStrategy) { showPopup('–ù–µ –≤—ã–±—Ä–∞–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è'); return; }
  if (amount <= 0) { showPopup('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É'); return; }
  if (!document.getElementById('niAgree').checked) { showPopup('–ù—É–∂–Ω–æ —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏'); return; }

  try {
    // —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –ª–æ–≥ (–ø–æ–∫–∞ ¬´–∑–∞–≥–ª—É—à–∫–∞¬ª ‚Äî –¥–æ–±–∞–≤—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ GAS –ø–æ–∑–∂–µ: action=logStrategyInvestment)
    const rate = window.__lastChosenStrategy; // '16' '17' '18'
    const resp = await apiGet(`?action=logStrategyInvestment&username=${window.username}&rate=${rate}&amount=${amount}`);
    // –¥–∞–∂–µ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –µ—â—ë –Ω–µ—Ç ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–ø–∏—Å—å
    const requestId = (resp && (resp.requestId || resp.id)) || crypto.randomUUID();
    const shortId   = String(requestId).split('-')[1] || String(requestId).slice(0,4);

    addPortfolioItem(shortId, amount, rate);
    addHistoryItem('strategy', amount, shortId, `–°—Ç—Ä–∞—Ç–µ–≥–∏—è ${rate}%`);

    showPopup(`[#${shortId}] –û—Ç–∫—Ä—ã—Ç–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞ ${fmtMoney(amount)} ‚ÇΩ`);
    closeModal('newInvestment');
  } catch(e){
    showPopup('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—é');
  }
});
    
    function showPopup(text, timeout = 3000) {
      const el = document.createElement('div');
      el.className = 'popup';
      el.textContent = text;
      document.body.appendChild(el);
      setTimeout(() => { 
        el.style.transition = 'opacity .25s ease, transform .25s ease'; 
        el.style.opacity = '0'; 
        el.style.transform = 'translateX(-50%) translateY(10px)';
        setTimeout(() => el.remove(), 250); 
      }, timeout);
    }

    function showDevPopup(text) {
      showPopup(text, 2000);
    }

    // Page navigation
    function openPage(pageId) {
      // Hide all pages
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      
      // Show selected page
      const page = document.getElementById(`page${pageId.charAt(0).toUpperCase() + pageId.slice(1)}`);
      if (page) {
        page.classList.add('active');
      }
      
      // Update nav
      event.target.closest('.nav-item').classList.add('active');
    }

    // Modal functions
    function openModal(modalId) {
      const modal = document.getElementById(`modal${modalId.charAt(0).toUpperCase() + modalId.slice(1)}`);
      if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    }

    function closeModal(modalId) {
      const modal = document.getElementById(`modal${modalId.charAt(0).toUpperCase() + modalId.slice(1)}`);
      if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
      }
    }

function addPortfolioItem(shortId, amount, rateCode){
  const host = document.querySelector('#pagePortfolio .card');
  if (!host) return;
  // –µ—Å–ª–∏ —Ç–∞–º –∑–∞–≥–ª—É—à–∫–∞ ‚Äî —É–±–∏—Ä–∞–µ–º –µ—ë –æ–¥–∏–Ω —Ä–∞–∑
  const stub = host.querySelector('p[style*="–í–∞—à–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö"]') || host.querySelector('p[style*="–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é"]');
  if (stub) stub.remove();

  const row = document.createElement('div');
  row.className = 'glass-card';
  row.style.marginBottom = '12px';
  row.innerHTML = `<b>#${shortId}</b> ¬∑ ${fmtMoney(amount)} ‚ÇΩ ¬∑ ${rateCode}%`;
  host.appendChild(row);
}

function addHistoryItem(type, amount, shortId, titleOpt){
  const host = document.querySelector('#pageHistory .card');
  if (!host) return;
  const row = document.createElement('div');
  row.className = 'glass-card';
  const title = titleOpt || (type==='deposit' ? '–î–µ–ø–æ–∑–∏—Ç' : type==='withdraw' ? '–í—ã–≤–æ–¥' : '–°—Ç—Ä–∞—Ç–µ–≥–∏—è');
  row.innerHTML = `<b>${title}</b> ¬∑ ${fmtMoney(amount)} ¬∑ #${shortId} ¬∑ <span class="muted">${mskYmd(mskNow()).slice(5)}</span>`;
  host.appendChild(row);
}

    
    // Close modals on overlay click
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('modal-overlay')) {
        e.target.classList.remove('active');
        document.body.style.overflow = '';
      }
    });

    // Currency functions
    function toggleCurrencyDropdown(event) {
      event.stopPropagation();
      const dropdown = document.getElementById('currencyDropdown');
      dropdown.classList.toggle('open');
    }

    function selectCurrency(currency, event) {
      event.stopPropagation();
      window.currentCurrency = currency;
      document.getElementById('currentCurrency').textContent = currency;
      
      // Update active state
      document.querySelectorAll('.currency-option').forEach(opt => opt.classList.remove('active'));
      event.target.classList.add('active');
      
      // Close dropdown
      document.getElementById('currencyDropdown').classList.remove('open');
      
      // Update display
      updateDisplay();
    }

    // Close currency dropdown when clicking outside
    document.addEventListener('click', function() {
      document.getElementById('currencyDropdown').classList.remove('open');
    });

    // Toggle functions
    function toggleSwitch(element) {
      element.classList.toggle('active');
    }

    function toggleDropdown(dropdownId) {
      const dropdown = document.getElementById(dropdownId);
      dropdown.classList.toggle('open');
    }

    function selectStrategy(strategy) {
      document.getElementById('selectedStrategy').textContent = strategy;
      document.getElementById('strategyDropdown').classList.remove('open');
      calculateProfit();
    }

    function toggleFilter(element, type) {
      if (type === 'all') {
        document.querySelectorAll('.filter-chip').forEach(chip => chip.classList.remove('active'));
        element.classList.add('active');
      } else {
        if (element.classList.contains('active')) {
          element.classList.remove('active');
        } else {
          document.querySelector('.filter-chip').classList.remove('active'); // Remove "All"
          element.classList.add('active');
        }
      }
    }

    // Amount formatting
    function formatAmount(input) {
      let value = input.value.replace(/[^\d]/g, '');
      if (value) {
        value = parseInt(value).toLocaleString('ru-RU');
      }
      input.value = value;
    }

    function setDepositAmount(amount) {
      const input = document.getElementById('depositAmount');
      input.value = amount.toLocaleString('ru-RU');
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showPopup('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
      });
    }

    function calculateProfit() {
      const strategy = document.getElementById('selectedStrategy').textContent;
      const amountStr = document.getElementById('calculatorAmount').value;
      const amount = parseInt(amountStr.replace(/[^\d]/g, '')) || 0;
      
      if (strategy === '–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é' || amount === 0) {
        document.getElementById('calculationResult').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏ –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É';
        return;
      }
      
      let rate = 0.16;
      if (strategy.includes('17%')) rate = 0.17;
      if (strategy.includes('18%')) rate = 0.18;
      
      const monthlyProfit = amount * rate / 12;
      const yearlyProfit = amount * rate;
      
      document.getElementById('calculationResult').innerHTML = `
        <div>–î–æ—Ö–æ–¥ –≤ –º–µ—Å—è—Ü: ${fmtMoney(monthlyProfit)} ‚ÇΩ</div>
        <div>–î–æ—Ö–æ–¥ –≤ –≥–æ–¥: ${fmtMoney(yearlyProfit)} ‚ÇΩ</div>
      `;
    }

    // Update display
    function updateDisplay() {
      const rate = window.exchangeRates[window.currentCurrency];
      const balance = window.serverBalance * rate;
      
      document.getElementById('balanceValue').textContent = fmtMoney(balance);
      document.getElementById('freeBalance').textContent = fmtMoney(balance);
      const invested = (window.monthBase || 0) * rate; // –≤ —Ç–µ–∫—É—â–µ–π –≤–∞–ª—é—Ç–µ
      document.getElementById('investedBalance').textContent = fmtMoney(invested);

      document.getElementById('availableBalance').textContent = fmtMoney(balance);
      
      // Update profile
      document.getElementById('profileUsername').textContent = window.username || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
      
      // Update next accrual
      const nextAccrual = balance * 0.16 / 365;
      document.getElementById('nextAccrualAmount').textContent = fmtMoney(nextAccrual);
    }

let __statusHideTimer = null;
let __lastStatusText  = '';

function showStatusOnce(text, type='loading', holdMs=1800) {
  const el = document.getElementById('status');
  if (!el) return;

  const newText = String(text || '').trim();
  const newClass = `status ${type}`;

  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —Ä–µ–∞–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
  if (newText === __lastStatusText && el.className === newClass) return;
  __lastStatusText = newText;

  el.textContent = newText;
  el.className = newClass;
  el.classList.add('show');

  if (__statusHideTimer) clearTimeout(__statusHideTimer);
  __statusHideTimer = setTimeout(() => {
    el.classList.remove('show'); // —É–µ–∑–∂–∞–µ—Ç –∑–∞ —ç–∫—Ä–∞–Ω
  }, holdMs);
}

// —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º –∫–æ–¥–æ–º
function setStatus(text, type='loading') {
  // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏ –ø—Ä—è—á–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  showStatusOnce(text, type);
}


    function setButtonsWaiting(isWaiting) {
      const simulateBtn = document.getElementById('simulateButton');
      if (simulateBtn) {
        simulateBtn.disabled = !!isWaiting;
        simulateBtn.textContent = isWaiting ? '–ù–∞—á–∏—Å–ª–µ–Ω–∏–µ...' : '–ò–º–∏—Ç–∞—Ü–∏—è –º–µ—Å—è—Ü–∞';
      }
    }

    // --- TG user ---
    function getTelegramUser() {
      try {
        const tg = window.Telegram?.WebApp; 
        tg?.expand?.();
        const initDataUnsafe = tg?.initDataUnsafe || {}; 
        const user = initDataUnsafe.user || null;
        if (user && user.username) return user.username;
        return 'marulin'; // fallback
      } catch { 
        return 'marulin'; 
      }
    }

    // --- API ---
    async function apiGet(path) { 
      const r = await fetch(`${SCRIPT_URL}${path}`); 
      return r.json(); 
    }

    async function initializeUser() {
      try {
        window.username = getTelegramUser();
        window.isInitialized = true;

        setStatus('–ó–∞–≥—Ä—É–∑–∫–∞...', 'loading');

        // Initial load
        const data = await apiGet(`?action=getBalance&username=${window.username}&debug=1`);
        if (!data.success) throw new Error(data.error || 'getBalance failed');
        
        window.serverBalance = Number(data.balance) || 0;
        window.currentRate = Number(data.rate) || 16;
        
        updateDisplay();
        try {
          const gb = await apiGet(`?action=getBalance&username=${window.username}`);
          if (gb.success) window.monthBase = Number(gb.monthBase || window.monthBase || 0);
        } catch(_) {}

        await refreshTodayIncome();
        setStatus('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ', 'synced');
        window.monthBase = Number(data.monthBase || 0);
        // Immediate sync
        await syncBalance();

        // Periodic sync
        setInterval(syncBalance, 20000);
      } catch (e) {
        console.error('Initialization error:', e);
        setStatus('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
      }
    }

    async function syncBalance() {
      if (!window.username || !window.isInitialized) return;
      try {
        const data = await apiGet(`?action=syncBalance&username=${window.username}&balance=${encodeURIComponent(window.serverBalance)}&rate=${encodeURIComponent(window.currentRate)}&timestamp=${Date.now()}&debug=1`);
        
        if (data.success) {
          if (typeof data.balance === 'number' && isFinite(data.balance)) {
            window.serverBalance = Number(data.balance);
          }
          if (typeof data.rate === 'number' && isFinite(data.rate)) {
            window.currentRate = Number(data.rate);
          }

          if (data.adminResponse && window.pendingRequest) {
            const resp = String(data.adminResponse).trim().toLowerCase();
            const shortId = data.adminResponseShortId || (data.adminResponseId ? (String(data.adminResponseId).split('-')[1] || '') : '');
            if (resp === 'approved') showPopup(shortId ? `[#${shortId}] –û–ø–µ—Ä–∞—Ü–∏—è –æ–¥–æ–±—Ä–µ–Ω–∞` : '–û–ø–µ—Ä–∞—Ü–∏—è –æ–¥–æ–±—Ä–µ–Ω–∞');
            if (resp === 'rejected') showPopup(shortId ? `[#${shortId}] –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞` : '–û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞');
            window.pendingRequest = false; 
            setButtonsWaiting(false);
          }

          updateDisplay();
          setStatus('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ', 'synced');
          await refreshTodayIncome();
        } else {
          setStatus('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏', 'error');
        }
      } catch (error) {
        console.error('Sync error:', error);
        setStatus('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 'error');
      }
    }

    async function sendDeposit(amount) {
      window.pendingRequest = true; 
      setButtonsWaiting(true);
      try {
        const data = await apiGet(`?action=requestDeposit&username=${window.username}&amount=${encodeURIComponent(amount)}`);
        if (data.success) {
          const shortId = data.requestShortId || (data.requestId ? (String(data.requestId).split('-')[1] || '') : '');
          addHistoryItem('deposit', amount, (data.requestShortId || (data.requestId ? String(data.requestId).split('-')[1] : '')));
          showPopup(shortId ? `–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω [#${shortId}]` : '–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
        } else {
          showPopup('–û—à–∏–±–∫–∞: ' + (data.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'));
          window.pendingRequest = false; 
          setButtonsWaiting(false);
        }
      } catch (error) {
        console.error('Deposit error:', error);
        showPopup('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞');
        window.pendingRequest = false; 
        setButtonsWaiting(false);
      }
    }

    async function sendWithdraw(amount) {
      window.pendingRequest = true; 
      setButtonsWaiting(true);
      try {
        const data = await apiGet(`?action=requestWithdraw&username=${window.username}&amount=${encodeURIComponent(amount)}`);
        if (data.success) {
          const shortId = data.requestShortId || (data.requestId ? (String(data.requestId).split('-')[1] || '') : '');
          addHistoryItem('withdraw', amount, (data.requestShortId || (data.requestId ? String(data.requestId).split('-')[1] : '')));
          showPopup(shortId ? `–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω [#${shortId}]` : '–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
        } else {
          showPopup('–û—à–∏–±–∫–∞: ' + (data.error || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'));
          window.pendingRequest = false; 
          setButtonsWaiting(false);
        }
      } catch (error) {
        console.error('Withdraw error:', error);
        showPopup('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–∞');
        window.pendingRequest = false; 
        setButtonsWaiting(false);
      }
    }

    async function simulateMonthlyInterest() {
      try {
        setButtonsWaiting(true);
        const data = await apiGet(`?action=applyMonthlyInterestNow&username=${window.username}&debug=1`);
        if (data.success && data.ok) {
          window.serverBalance = Number(data.newBalance) || window.serverBalance;
          updateDisplay();
          showPopup(`–ü—Ä–æ—Ü–µ–Ω—Ç—ã –Ω–∞—á–∏—Å–ª–µ–Ω—ã\n–±–∞–∑–∞ = ${(data.baseUsed??0).toLocaleString('ru-RU', {maximumFractionDigits:2})}\n% = ${(data.interestAmount??0).toLocaleString('ru-RU', {maximumFractionDigits:2})}`);
        } else {
          showPopup('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç—ã');
        }
      } catch (e) {
        console.error('Simulate error:', e);
        showPopup('–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤');
      } finally {
        setButtonsWaiting(false);
      }
    }

    // Specific modal functions
    function showP2PInfo() {
      closeModal('deposit');
      showPopup(`P2P –¥–µ–ø–æ–∑–∏—Ç\n\n–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ –Ω–æ–º–µ—Ä:\n+7 916 643 54 94\n\n–ü–æ—Å–ª–µ –ø–µ—Ä–µ–≤–æ–¥–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º`, 5000);
    }

    function showWithdrawForm() {
      closeModal('withdraw');
      sendWithdraw(100000); // Default amount
    }

    function startInvestment() {
      closeModal('strategy1');
      sendDeposit(100000); // Default investment amount
    }

    function startInvestment30() {
      closeModal('strategy30');
      sendDeposit(100000); // Default investment amount
    }

    function startInvestment90() {
      closeModal('strategy90');
      sendDeposit(100000); // Default investment amount
    }

    function openDocuments() {
      closeModal('profile');
      window.open('https://docs.google.com/document/d/1Rv3N2iTgwHXhTkSgv-BwKLrekVpZtoGfU_ct2lDw00g/edit?usp=sharing', '_blank');
    }

function mskNow() {
  return new Date(new Date().toLocaleString('en-US', { timeZone: 'Europe/Moscow' }));
}
function mskYmd(d=new Date()) {
  const yy=d.getFullYear(), mm=String(d.getMonth()+1).padStart(2,'0'), dd=String(d.getDate()).padStart(2,'0');
  return `${yy}-${mm}-${dd}`;
}

async function refreshTodayIncome() {
  try {
    const res = await apiGet(`?action=previewAccrual&username=${window.username}`);
    if (!res.success) throw new Error('previewAccrual failed');

    const todayKey = `acc0_${window.username}_${mskYmd(mskNow())}`;
    // –µ—Å–ª–∏ –Ω–µ—Ç —Å–ª–µ–ø–∫–∞ –Ω–∞ –ø–æ–ª–Ω–æ—á—å ‚Äî —Å–æ–∑–¥–∞—ë–º (–±–µ—Ä–µ–º —Ç–µ–∫—É—â–µ–µ accruedToNow –∫–∞–∫ —Å—Ç–∞—Ä—Ç –¥–Ω—è)
    if (localStorage.getItem(todayKey) === null) {
      localStorage.clear?.(); // –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç ¬´–≤–∏—Å—è–∫–∏¬ª —Å—Ç–∞—Ä—ã—Ö –∫–ª—é—á–µ–π
      localStorage.setItem(todayKey, String(res.accruedToNow || 0));
    }
    const startOfDayAccrued = Number(localStorage.getItem(todayKey) || 0);
    const todayIncome = Math.max(0, Number(res.accruedToNow || 0) - startOfDayAccrued);

    const el = document.getElementById('todayIncome');
    if (el) el.textContent = `+${fmtMoney(todayIncome)}`;
  } catch (e) {
    // –º–æ–ª—á–∞ –∏–≥–Ω–æ—Ä–∏–º ‚Äî –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è UI
    // console.warn('today income err', e);
  }
}

    
    // Initialize on load
    (function init() {
      const tg = window.Telegram?.WebApp;
      try { 
        tg?.expand?.(); 
        tg?.ready?.();
        
        // Adapt to Telegram theme
        if (tg?.themeParams) {
          const theme = tg.themeParams;
          document.documentElement.style.setProperty('--bg-primary', theme.bg_color || '#0a0b0f');
          document.documentElement.style.setProperty('--text-primary', theme.text_color || '#e8eaed');
        }
      } catch {}
      
      initializeUser();
    })();
  </script>
</body>
</html>
