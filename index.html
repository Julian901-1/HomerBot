<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>HomerBot — Инвестиционный Кошелёк</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&display=swap" rel="stylesheet">
  <style>
    :root { 
      --bg-primary: #0a0b0f; 
      --text-primary: #e8eaed; 
      --text-secondary: rgba(232,234,237,0.7); 
      --accent: #4c8bf5; 
      --accent-hover: #5a95f7;
      --success: #34d399; 
      --warning: #fbbf24;
      --error: #f87171;
      --glass-bg: rgba(30, 32, 40, 0.7); 
      --glass-border: rgba(255, 255, 255, 0.1);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif; 
      background: var(--bg-primary); 
      color: var(--text-primary); 
      -webkit-text-size-adjust: 100%;
    }
    .app-container { max-width: 430px; margin: 0 auto; min-height: 100vh; position: relative; }
    
    /* Header & Nav */
    .header { position: sticky; top: 0; z-index: 100; background: rgba(10, 11, 15, 0.5); backdrop-filter: blur(20px); border-bottom: 1px solid var(--glass-border); padding: 12px 20px; }
    .header-content { display: flex; justify-content: space-between; align-items: center; }
    .logo { font-family: 'Comfortaa', cursive; font-size: 24px; }
    .profile-btn, .btn, .copy-btn, .quick-amount-btn, .method-card, .filter-chip { background: var(--glass-bg); border: 1px solid var(--glass-border); transition: all 0.2s ease; cursor: pointer; }
    .profile-btn:hover, .btn:hover, .copy-btn:hover, .quick-amount-btn:hover, .method-card:not(.disabled):hover, .filter-chip:hover:not(.active) { background: rgba(255,255,255,0.1); transform: translateY(-1px); }
    .profile-btn { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; }
    .bottom-nav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 430px; background: var(--glass-bg); backdrop-filter: blur(20px); border-top: 1px solid var(--glass-border); padding: 12px 20px 20px; z-index: 100; border-radius: 24px 24px 0 0; }
    .nav-items { display: flex; justify-content: space-around; }
    .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 12px; border-radius: 12px; opacity: 0.6; cursor: pointer; }
    .nav-item.active { opacity: 1; background: rgba(255,255,255,0.1); }
    .nav-icon { width: 24px; height: 24px; stroke: currentColor; fill: none; stroke-width: 2; }
    .nav-label { font-size: 11px; font-weight: 500; }
    
    /* Modals */
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 1000; display: none; align-items: flex-end; justify-content:center;}
    .modal-overlay.active { display: flex; }
    .modal { background: #10121a; border-radius: 24px 24px 0 0; width: 100%; max-width: 430px; max-height: 90vh; overflow-y: auto; padding: 24px; animation: slideUp 0.3s ease; border-top: 1px solid var(--glass-border); }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    
    /* General */
    .page { display: none; padding: 20px 20px 120px; }
    .page.active { display: block; }
    .card { background: rgba(30, 32, 40, 0.5); border: 1px solid var(--glass-border); border-radius: 20px; padding: 24px; margin-bottom: 16px; backdrop-filter: blur(10px); }
    .glass-card { background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 16px; padding: 16px; margin-bottom: 12px; }

    /* Balance + stats (centered + autosize) */
    .balance-section { text-align: center; }
    .balance-label-container { display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 8px; position: relative;}
    .balance-label { font-size: 14px; color: var(--text-secondary); }
    .balance-main { font-size: 42px; white-space: nowrap; font-weight: 800; display:block; margin: 0 auto; line-height: 1.15; }
    .balance-currency { font-size: 14px; color: var(--text-secondary); font-weight: 600; cursor: pointer; position: relative; border-radius: 8px; padding: 2px 6px; }
    .currency-arrow { font-size: 10px; opacity: 0.7; margin-left: 4px; }
    .currency-dropdown { position: absolute; top: 100%; left: 50%; transform: translateX(-50%); margin-top: 8px; background: #1d1f2a; border: 1px solid var(--glass-border); border-radius: 12px; padding: 8px; display: none; z-index: 10; }
    .currency-dropdown.open { display: block; }
    .currency-option { padding: 8px 16px; cursor: pointer; border-radius: 8px; transition: background 0.2s; }
    .currency-option:hover { background: var(--glass-bg); }
    .currency-option.active { background: var(--accent); color: white; }

    .balance-stats { display: flex; justify-content: space-between; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--glass-border); gap: 8px; }
    .balance-stat { flex: 1; text-align: center; }
    .stat-label { font-size: 12px; color: var(--text-secondary); margin-bottom: 4px; }
    .stat-value { font-size: 16px; font-weight: 700; }
    .stat-positive { color: var(--success); }

    .btn-group { display: flex; gap: 12px; margin-bottom: 24px; }
    .btn { flex: 1; padding: 16px 24px; border-radius: 16px; font-size: 16px; font-weight: 700; color: var(--text-primary); }
    .btn-primary { background: var(--accent); border-color: var(--accent) !important; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }

    .strategies-section h2 { font-size: 20px; font-weight: 700; margin-bottom: 16px; }
    .strategy-cards { display: flex; flex-direction: column; gap: 12px; }
    .strategy-card { cursor: pointer; }
    .strategy-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .strategy-name { font-size: 18px; font-weight: 700; }
    .strategy-rate { font-size: 24px; font-weight: 800; color: var(--accent); }
    .strategy-description { font-size: 14px; color: var(--text-secondary); margin-bottom: 16px; }
    .strategy-features { display: flex; gap: 8px; flex-wrap: wrap; }
    .feature-tag { padding: 4px 8px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: 8px; font-size: 12px; }

    .status { position:fixed; top:80px; right:20px; padding:8px 12px; border-radius:12px; background:var(--glass-bg); border:1px solid var(--glass-border); font-size:12px; backdrop-filter:blur(10px); z-index:9999; transform:translateX(130%); opacity:0; transition:transform .35s ease, opacity .35s ease; pointer-events:none; }
    .status.show { transform:translateX(0); opacity:1; }
    .status.loading { color:var(--warning); } .status.synced { color:var(--success); } .status.error { color:var(--warning); }

    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .modal-title { font-size: 20px; font-weight: 700; }
    .close-btn { background: var(--glass-bg); border: 1px solid var(--glass-border); width: 32px; height: 32px; border-radius: 8px; cursor: pointer; font-size: 18px; color: var(--text-primary); display: flex; align-items: center; justify-content: center; }

    .popup { position: fixed; left: 50%; bottom: 120px; transform: translateX(-50%); background: rgba(20,20,20,0.95); color: white; padding: 16px 20px; border-radius: 16px; font-size: 14px; z-index: 9999; max-width: 90vw; text-align: center; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); white-space: pre-line; }

    .filter-chips { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
    .filter-chip { padding: 8px 16px; border-radius: 20px; font-size: 14px; }
    .filter-chip.active { background: var(--accent); color: white; border-color: var(--accent); }

    .amount-input, .input-field { background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border); border-radius: 12px; color: var(--text-primary); padding: 12px; width: 100%; }
    .amount-input { font-size: 24px; font-weight: 700; text-align: center; margin-bottom: 16px; }
    .quick-amounts { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 16px 0; }
    .quick-amount-btn { padding: 12px; border-radius: 12px; font-size: 14px; color: #fff; }

    .method-card { border-radius: 16px; padding: 20px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
    .method-card.disabled { opacity: 0.5; cursor: not-allowed; }
    .method-info h3 { font-size: 16px; font-weight: 700; margin-bottom: 4px; }
    .method-info p { font-size: 14px; color: var(--text-secondary); }

    .dev-notice { background: var(--warning); color: #000; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600; display: inline-block; margin-left: 8px; vertical-align: middle; }

    .copy-btn { border-radius: 8px; width: 48px; height: 48px; display:flex; align-items:center; justify-content:center; margin-left:8px; flex-shrink: 0;}

    .history-item.status-approved { background: rgba(52, 211, 153, 0.1); border-color: rgba(52, 211, 153, 0.2); }
    .history-item.status-pending { background: rgba(251, 191, 36, 0.1); border-color: rgba(251, 191, 36, 0.2); }
    .history-item.status-rejected { background: rgba(248, 113, 113, 0.1); border-color: rgba(248, 113, 113, 0.2); }

    .bank-icons { display: flex; gap: 10px; justify-content: center; margin: 16px 0; }
    .bank-icon { width: 50px; height: 50px; border-radius: 12px; border: 2px solid transparent; padding: 5px; background-color: #fff; cursor: pointer; }
    .bank-icon.selected { border-color: var(--accent); }
    .bank-icon img { width: 100%; height: 100%; object-fit: contain; }

    #withdraw-recipient-select { width: 100%; padding: 12px; background: var(--glass-bg); border: 1px solid var(--glass-border); color: var(--text-primary); border-radius: 12px; margin: 16px 0; }

    /* Toggle Switch */
    .toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--glass-bg); border: 1px solid var(--glass-border); transition: .4s; border-radius: 26px; }
    .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--accent); }
    input:checked + .slider:before { transform: translateX(24px); }

    /* Disable scroll when modal is open */
    body.modal-open { overflow: hidden; }
  </style>
</head>
<body>
    <div class="app-container">
        <div class="header">
          <div class="header-content">
            <div class="logo">HomerBot</div>
            <button class="profile-btn" onclick="openModal('profile')">
              <svg class="nav-icon" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            </button>
          </div>
        </div>
        <div id="status" class="status"></div>

        <div id="pageContainer">
            <div class="page active" id="pageHome">
                <div class="card">
                    <div class="balance-section">
                        <div class="balance-label-container">
                            <div class="balance-label">Общий баланс</div>
                            <div class="balance-currency" onclick="toggleCurrencyDropdown(event)">
                                <span id="currentCurrency">RUB</span><span class="currency-arrow">▼</span>
                                <div class="currency-dropdown" id="currencyDropdown">
                                    <div class="currency-option active" onclick="selectCurrency('RUB', event)">RUB</div>
                                    <div class="currency-option" onclick="selectCurrency('USD', event)">USD</div>
                                    <div class="currency-option" onclick="selectCurrency('EUR', event)">EUR</div>
                                </div>
                            </div>
                        </div>
                        <div class="balance-main" id="balanceValue">—</div>
                        <div class="balance-stats">
                            <div class="balance-stat">
                              <div class="stat-label">Свободно</div>
                              <div class="stat-value" id="freeBalance">—</div>
                            </div>
                            <div class="balance-stat">
                              <div class="stat-label">Инвестировано</div>
                              <div class="stat-value stat-positive" id="investedBalance">—</div>
                            </div>
                            <div class="balance-stat">
                              <div class="stat-label">Доход сегодня</div>
                              <div class="stat-value stat-positive" id="todayIncome">+0.00</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                  <button class="btn btn-primary" onclick="openModal('deposit')">Депозит</button>
                  <button class="btn" onclick="openModal('withdraw')">Вывод</button>
                </div>

                <div class="strategies-section">
                    <h2>Инвестиционные стратегии</h2>
                    <div class="strategy-cards">
                        <div class="strategy-card glass-card" onclick="openModal('strategy16')">
                          <div class="strategy-header"><div class="strategy-name">Гибкая</div><div class="strategy-rate">16%</div></div>
                          <div class="strategy-description">Вывод в любое время без штрафа.</div>
                          <div class="strategy-features"><span class="feature-tag">Без заморозки</span><span class="feature-tag">Банковские вклады</span></div>
                        </div>
                        <div class="strategy-card glass-card" onclick="openModal('strategy17')">
                          <div class="strategy-header"><div class="strategy-name">30 дней</div><div class="strategy-rate">17%</div></div>
                          <div class="strategy-description">Доступен досрочный вывод, но с потерей процентов.</div>
                          <div class="strategy-features"><span class="feature-tag">Заморозка на 30 дней</span><span class="feature-tag">Банковские вклады</span><span class="feature-tag">ЦФА</span></div>
                        </div>
                        <div class="strategy-card glass-card" onclick="openModal('strategy18')">
                          <div class="strategy-header"><div class="strategy-name">90 дней</div><div class="strategy-rate">18%</div></div>
                          <div class="strategy-description">Доступен досрочный вывод, но с потерей процентов.</div>
                          <div class="strategy-features"><span class="feature-tag">Заморозка на 90 дней</span><span class="feature-tag">Банковские вклады</span><span class="feature-tag">ЦФА</span><span class="feature-tag">Займы</span><span class="feature-tag">Максимальная прибыль</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page" id="pagePortfolio">
              <div class="card">
                <h2 style="margin-bottom: 16px;">Мой портфель</h2>
                <div id="portfolio-list"></div>
                <p id="portfolio-placeholder" style="text-align: center; padding: 40px 0;">Нет активных инвестиций.</p>
              </div>
            </div>

            <div class="page" id="pageHistory">
              <div class="card">
                <h2 style="margin-bottom: 16px;">История операций</h2>
                <div class="filter-chips">
                  <div class="filter-chip active" onclick="applyHistoryFilter(this, 'all')">Все</div>
                  <div class="filter-chip" onclick="applyHistoryFilter(this, 'deposit')">Депозит</div>
                  <div class="filter-chip" onclick="applyHistoryFilter(this, 'withdraw')">Вывод</div>
                  <div class="filter-chip" onclick="applyHistoryFilter(this, 'invest')">Инвестиции</div>
                </div>
                <div id="history-list"></div>
                <button class="btn" id="load-more-history" style="width:100%; margin-top:16px; display:none;">Загрузить ещё</button>
                <p id="history-placeholder" style="text-align: center; padding: 40px 0;">История операций пуста.</p>
              </div>
            </div>
        </div>

        <div class="bottom-nav">
          <div class="nav-items">
            <div class="nav-item active" onclick="openPage('Home')">
              <svg class="nav-icon" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg>
              <span class="nav-label">Главная</span>
            </div>
            <div class="nav-item" onclick="openPage('Portfolio')">
              <svg class="nav-icon" viewBox="0 0 24 24"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
              <span class="nav-label">Портфель</span>
            </div>
            <div class="nav-item" onclick="openPage('History')">
              <svg class="nav-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>
              <span class="nav-label">История</span>
            </div>
          </div>
        </div>
    </div>

    <!-- Profile -->
    <div id="modalProfile" class="modal-overlay">
      <div class="modal">
        <div class="modal-header"><h2 class="modal-title">Профиль</h2><button class="close-btn" onclick="closeModal('profile')">✕</button></div>
        <div class="card" style="text-align: center; margin: 0;">
          <h3 id="profileUsername">—</h3>
          <p style="color: var(--text-secondary); font-size: 14px;">Telegram пользователь</p>
        </div>
        <div style="margin-top: 16px;">
          <div class="method-card disabled"><div class="method-info"><h3>Безопасность <span class="dev-notice">В разработке</span></h3><p>KYC, Пин-код, Подтверждение вывода</p></div></div>
          <div class="method-card disabled"><div class="method-info"><h3>Язык <span class="dev-notice">В разработке</span></h3><p>Русский, English</p></div></div>
          <div class="method-card" onclick="window.open('https://docs.google.com/document/d/1Rv3N2iTgwHXhTkSgv-BwKLrekVpZtoGfU_ct2lDw00g/edit?usp=sharing', '_blank')"><div class="method-info"><h3>Юридическая информация</h3><p>Условия использования</p></div></div>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; margin-top:16px; background:var(--glass-bg); border:1px solid var(--glass-border); border-radius:12px;">
          <label for="devModeToggle">Режим разработчика</label>
          <label class="toggle-switch"><input type="checkbox" id="devModeToggle"><span class="slider"></span></label>
        </div>
      </div>
    </div>

    <!-- Deposit -->
    <div id="modalDeposit" class="modal-overlay">
      <div class="modal">
        <div class="modal-header"><h2 class="modal-title">Депозит</h2><button class="close-btn" onclick="closeModal('deposit')">✕</button></div>
        <div id="deposit-methods-view">
          <div class="method-card disabled"><div class="method-info"><h3>Криптовалюта <span class="dev-notice">В разработке</span></h3></div></div>
          <div class="method-card disabled"><div class="method-info"><h3>Банковская карта <span class="dev-notice">В разработке</span></h3></div></div>
          <div class="method-card" onclick="document.getElementById('p2p-details').style.display='block'; this.parentElement.style.display='none';">
            <div class="method-info"><h3>Перевод по СБП</h3><p>На номер +7 916 643 54 94</p></div>
          </div>
        </div>
        <div id="p2p-details" style="display:none;">
          <input type="text" id="depositAmount" class="amount-input" placeholder="0" oninput="formatAmountInput(this)">
          <div class="quick-amounts">
            <button class="quick-amount-btn" onclick="setDepositAmount(1000)">1 000</button>
            <button class="quick-amount-btn" onclick="setDepositAmount(5000)">5 000</button>
            <button class="quick-amount-btn" onclick="setDepositAmount(10000)">10 000</button>
            <button class="quick-amount-btn" onclick="setDepositAmount(25000)">25 000</button>
            <button class="quick-amount-btn" onclick="setDepositAmount(50000)">50 000</button>
            <button class="quick-amount-btn" onclick="setDepositAmount(100000)">100 000</button>
          </div>
          <div style="display:flex; margin-top: 12px;">
            <input type="text" class="input-field" value="+7 (916) 643-54-94" readonly
                   style="text-align:center; font-size:18px; font-weight:700;">
            <button class="copy-btn" onclick="copyToClipboard('+79166435494', this)">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
            </button>
          </div>
          <label style="display:flex; gap:8px; align-items:center; margin:16px 0;"><input type="checkbox" id="depositAgree"> <span>Я согласен с <a href="https://docs.google.com/document/d/1Rv3N2iTgwHXhTkSgv-BwKLrekVpZtoGfU_ct2lDw00g/edit?usp=sharing" target="_blank" style="color:var(--accent)">условиями</a></span></label>
          <button class="btn btn-primary" id="depositConfirmBtn" style="width:100%" disabled>Создать запрос</button>
        </div>
      </div>
    </div>

    <!-- Withdraw -->
    <div id="modalWithdraw" class="modal-overlay">
      <div class="modal">
        <div class="modal-header"><h2 class="modal-title">Вывод средств</h2><button class="close-btn" onclick="closeModal('withdraw')">✕</button></div>

        <div id="withdraw-method-choice" style="display:none;">
          <div class="method-card" onclick="showAddRecipientForm('sbp')"><div class="method-info"><h3>Перевод по СБП</h3></div></div>
          <div class="method-card disabled"><div class="method-info"><h3>Криптовалюта <span class="dev-notice">В разработке</span></h3></div></div>
          <div class="method-card disabled"><div class="method-info"><h3>Банковские реквизиты <span class="dev-notice">В разработке</span></h3></div></div>
        </div>

        <div id="withdraw-view" style="display:none;">
          <p style="text-align: center; color: var(--text-secondary);">Доступно для вывода: <b id="withdrawAvailable">0.00 ₽</b></p>
          <select id="withdraw-recipient-select"></select>
          <input type="text" class="amount-input" id="withdrawAmount" placeholder="0" oninput="formatAmountInput(this)">
          <button class="btn btn-primary" id="withdrawConfirmBtn" style="width:100%">Создать запрос</button>
        </div>

        <div id="withdraw-add-sbp-form" style="display:none;">
          <input type="text" class="input-field" id="withdraw-sbp-phone" style="text-align:center; margin-bottom: 16px;" placeholder="Номер телефона для СБП">
          <p style="text-align:center; color: var(--text-secondary); font-size: 14px;">Выберите банк получателя</p>
            <div class="bank-icons">
              <div class="bank-icon" data-bank="Alfa">
                <img src="https://downloader.disk.yandex.ru/disk/b34143b32a920f40131c60c3f6161810023e1dcc047be08cc99b4276bbe9ba3c/68caf7d7/m1Lm_ikQY-ZIcWcthtapqfJYMNsSTz_of0NmlpzWad27dKHFITTIr4_bGAbSeg0mnFjAS_20lL6h99OjnV073A%3D%3D?uid=0&filename=alphabanklogo.jpg&disposition=attachment&hash=czH1I9lZfh0xMarQNNklT33cK65PruSMoLCKQYafTptL8OYyvy2KGxc7d0KsrY/0q/J6bpmRyOJonT3VoXnDag%3D%3D%3A&limit=0&content_type=image%2Fjpeg&owner_uid=805280616&fsize=27328&hid=49b61d5744d585864136b87cd3cc5346&media_type=image&tknv=v3" alt="Альфа">
              </div>
              <div class="bank-icon" data-bank="Sberbank">
                <img src="https://downloader.disk.yandex.ru/disk/2450ae5bcc70aed748d948635f0b711a7c4d4423cc24b2e95461591415cce730/68caf82b/m1Lm_ikQY-ZIcWcthtapqS9Z3ukXh4Rliwd3bagtdQJ7oALIF8T_t1P1Tgr5kGOOe45nKbOsXkerQdkQT8JUuw%3D%3D?uid=0&filename=sberbanklogo.jpg&disposition=attachment&hash=0/hk15zDXmbzUoBv6Gp5kEhgzQAXTV8P4HYZBXNxwKMwPFXGTvh84ySjZb0ExYrBq/J6bpmRyOJonT3VoXnDag%3D%3D%3A&limit=0&content_type=image%2Fjpeg&owner_uid=805280616&fsize=41167&hid=2e594d8f20f93ed8b8e0a2059d4dc950&media_type=image&tknv=v3" alt="Сбербанк">
              </div>
              <div class="bank-icon" data-bank="TBank">
                <img src="https://downloader.disk.yandex.ru/disk/da3b338f12029d649404140a6ffa0cd0dcb77a62c354c5467e28711176fea501/68caf846/m1Lm_ikQY-ZIcWcthtapqa8p32RaGHRBcfPANsk7vd5dNGWa2PyvQSsOIFb-NIrh3SajL9LVkr8hTU8ya7wg-Q%3D%3D?uid=0&filename=tbanklogo.jpg&disposition=attachment&hash=XtEqmEjjg9gQXv38C3I4WFUBRYh63CEd57JU5EyfPbhtHBChNuzUvPyEAqC7mBhTq/J6bpmRyOJonT3VoXnDag%3D%3D%3A&limit=0&content_type=image%2Fjpeg&owner_uid=805280616&fsize=25002&hid=1ab7dc748caae49151784d1a67b34c96&media_type=image&tknv=v3" alt="Т-Банк">
              </div>
            </div>
          <button class="btn btn-primary" id="save-sbp-btn" style="width:100%; margin-top: 16px;">Сохранить и продолжить</button>
        </div>
      </div>
    </div>
    
    <!-- Strategies -->
    <div id="modalStrategy16" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">Гибкая 16%</h2>
          <button class="close-btn" onclick="closeModal('strategy16')">✕</button>
        </div>
        <button class="btn btn-primary" onclick="openNewInvestment('16')" style="width: 100%;">Инвестировать</button>
      </div>
    </div>
    <div id="modalStrategy17" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">30 дней 17%</h2>
          <button class="close-btn" onclick="closeModal('strategy17')">✕</button>
        </div>
        <button class="btn btn-primary" onclick="openNewInvestment('17')" style="width: 100%;">Инвестировать</button>
      </div>
    </div>
    <div id="modalStrategy18" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">90 дней 18%</h2>
          <button class="close-btn" onclick="closeModal('strategy18')">✕</button>
        </div>
        <button class="btn btn-primary" onclick="openNewInvestment('18')" style="width: 100%;">Инвестировать</button>
      </div>
    </div>

    <!-- New Investment -->
    <div id="modalNewInvestment" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">Новая инвестиция</h2>
          <button class="close-btn" onclick="closeModal('newInvestment')">✕</button>
        </div>
        <div class="input-field" id="niStrategyReadonly" style="text-align:center;font-weight:700;margin-bottom:12px;">—</div>
        <input type="text" class="amount-input" id="niAmount" placeholder="0" oninput="formatAmountInput(this)">
        <button class="btn btn-primary" style="width:100%" id="niConfirmBtn">Подтвердить</button>
      </div>
    </div>

    <script>
      const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzIAGI3xqdLJeOGHs8cgvLbMll5x82pc7clF_HTmQBQkc-5jbONBaq27NPZuaQAfuR_oA/exec';

      // -------- STATE --------
      let username = null;
      let serverState = { balance: 0, rate: 16, monthBase: 0, lockedAmount: 0, history: [], portfolio: [] };
      let userPrefs = { currency: 'RUB', sbpMethods: [] };
      let devMode = false;
      let lastChosenRate = null;

      // Status: показываем loading/synced только один раз
      let hasShownInitialStatus = false;

      // Курсы и доход сегодня (в RUB) для мгновенного пересчёта
      const exchangeRates = { RUB: 1, USD: 0.011, EUR: 0.010 };
      let latestTodayIncomeRub = 0;

      // История — пагинация и фильтр
      let historyOffset = 0;
      const HISTORY_PAGE_SIZE = 10;
      let currentHistoryFilterType = 'all';
      let filteredHistory = [];

      // -------- HELPERS --------
      const fmtMoney = (val, currency) => {
        const rate = exchangeRates[currency];
        const num = (Number(val) || 0) * rate;
        return num.toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      };

      function formatAmountInput(input) {
        let value = input.value.replace(/\s/g, '').replace(/[^\d]/g, '');
        input.value = value ? parseInt(value, 10).toLocaleString('ru-RU') : '';
      }

      function showPopup(text, timeout = 3000) {
        const el = document.createElement('div');
        el.className = 'popup';
        el.textContent = text;
        document.body.appendChild(el);
        setTimeout(() => {
          el.style.transition = 'opacity .25s ease, transform .25s ease';
          el.style.opacity = '0';
          el.style.transform = 'translateX(-50%) translateY(10px)';
          setTimeout(() => el.remove(), 250);
        }, timeout);
      }

      function setStatus(text, type = 'loading') {
        const el = document.getElementById('status');
        if (!el) return;

        // Показываем "loading/synced" только при первом подключении
        if ((type === 'loading' || type === 'synced') && hasShownInitialStatus) return;

        el.textContent = text;
        el.className = `status ${type} show`;

        if (type === 'error') {
          setTimeout(() => el.classList.remove('show'), 3000);
        } else if (type === 'synced') {
          setTimeout(() => el.classList.remove('show'), 1500);
          hasShownInitialStatus = true;
        }
      }

      // -------- NAV & MODALS --------
      function openPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(`page${pageId}`).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => {
          n.classList.remove('active');
          if (n.onclick.toString().includes(`'${pageId}'`)) n.classList.add('active');
        });
      }

      function openModal(modalId) {
        const modal = document.getElementById(`modal${modalId.charAt(0).toUpperCase() + modalId.slice(1)}`);
        if (!modal) return;
        modal.classList.add('active');
        document.body.classList.add('modal-open');

        // Спец-логика для "Вывод"
        if (modalId === 'withdraw') {
          const hasMethods = (userPrefs.sbpMethods || []).length > 0;
          document.getElementById('withdraw-method-choice').style.display = hasMethods ? 'none' : 'block';
          document.getElementById('withdraw-add-sbp-form').style.display = 'none';
          document.getElementById('withdraw-view').style.display = hasMethods ? 'block' : 'none';
        }
      }

      function closeModal(modalId) {
        const modal = document.getElementById(`modal${modalId.charAt(0).toUpperCase() + modalId.slice(1)}`);
        if (modal) modal.classList.remove('active');
        const anyOpen = Array.from(document.querySelectorAll('.modal-overlay')).some(m => m.classList.contains('active'));
        if (!anyOpen) document.body.classList.remove('modal-open');
      }

      // -------- BALANCE AUTOSIZE --------
      function fitBalanceText() {
        const el = document.getElementById('balanceValue');
        if (!el) return;
        const max = 42, min = 18;
        el.style.fontSize = max + 'px';
        const limit = el.parentElement ? el.parentElement.clientWidth - 24 : el.clientWidth;
        let size = max, safety = 50;
        while (el.scrollWidth > limit && size > min && safety-- > 0) {
          size -= 1;
          el.style.fontSize = size + 'px';
        }
      }
      window.addEventListener('resize', fitBalanceText);

      // -------- RENDER --------
      function updateDashboard(data) {
        serverState = { ...serverState, ...data };
        const { balance, monthBase, lockedAmount } = serverState;
        const currency = userPrefs.currency;
        const currencySymbol = currency === 'RUB' ? '₽' : (currency === 'USD' ? '$' : '€');

        document.getElementById('balanceValue').textContent = `${fmtMoney(balance, currency)} ${currencySymbol}`;
        document.getElementById('freeBalance').textContent = `${fmtMoney(balance - lockedAmount, currency)} ${currencySymbol}`;
        document.getElementById('investedBalance').textContent = `${fmtMoney(monthBase, currency)} ${currencySymbol}`;
        document.getElementById('profileUsername').textContent = username || 'Пользователь';
        document.getElementById('withdrawAvailable').innerHTML = `${fmtMoney(balance - lockedAmount, currency)} ${currencySymbol}`;

        // Доход сегодня — мгновенно под выбранную валюту
        document.getElementById('todayIncome').textContent = `+${fmtMoney(latestTodayIncomeRub, currency)}`;

        fitBalanceText();
      }

      function getHistoryFilterPredicate(type) {
        if (!type || type === 'all') return () => true;
        const map = { deposit: 'DEPOSIT', withdraw: 'WITHDRAW', invest: 'INVEST' };
        const wanted = map[type] || null;
        return (item) => !wanted || (item.type === wanted);
      }

      function recomputeFilteredHistory() {
        const pred = getHistoryFilterPredicate(currentHistoryFilterType);
        filteredHistory = (serverState.history || []).filter(pred);
      }

      function renderHistoryPage(append = false) {
        const list = document.getElementById('history-list');
        const placeholder = document.getElementById('history-placeholder');
        const loadMoreBtn = document.getElementById('load-more-history');

        if (!append) {
          historyOffset = 0;
          list.innerHTML = '';
        }

        const slice = filteredHistory.slice(historyOffset, historyOffset + HISTORY_PAGE_SIZE);

        if (!append && filteredHistory.length === 0) {
          placeholder.style.display = 'block';
          loadMoreBtn.style.display = 'none';
          return;
        }
        placeholder.style.display = 'none';

        const currency = userPrefs.currency;
        const currencySymbol = currency === 'RUB' ? '₽' : (currency === 'USD' ? '$' : '€');

        slice.forEach(item => {
          const el = document.createElement('div');
          el.className = `glass-card history-item status-${item.status.toLowerCase()}`;

          const date = new Date(item.date);
          const timeStr = `${String(date.getDate()).padStart(2,'0')}.${String(date.getMonth()+1).padStart(2,'0')}.${String(date.getFullYear()).slice(-2)} ${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2,'0')}`;

          const absAmount = Math.abs(item.amount);
          let title = '', amountStr = '', subTitle = '';

          switch(item.type) {
            case 'DEPOSIT':  title = 'Депозит';    amountStr = `+${fmtMoney(absAmount, currency)}`; break;
            case 'WITHDRAW': title = 'Вывод';      amountStr = `-${fmtMoney(absAmount, currency)}`; break;
            case 'INVEST':
              title = 'Инвестиция';
              amountStr = `${fmtMoney(absAmount, currency)}`;
              subTitle = `<div style="font-size:12px;color:var(--text-secondary);">Стратегия: ${item.rate}%</div>`;
              break;
          }

          const uid = devMode ? ` · #${item.shortId}` : '';
          el.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:flex-start;">
              <div><b>${title}</b>${subTitle}<div style="font-size:12px;color:var(--text-secondary);margin-top:4px;">${timeStr}${uid}</div></div>
              <div style="font-weight:700;font-size:16px;text-align:right;">${amountStr} ${currencySymbol}</div>
            </div>`;
          list.appendChild(el);
        });

        historyOffset += slice.length;
        loadMoreBtn.style.display = historyOffset < filteredHistory.length ? 'block' : 'none';
      }

      function applyHistoryFilter(element, type) {
        if (type) currentHistoryFilterType = type;
        if (element) {
          document.querySelectorAll('.filter-chip').forEach(chip => chip.classList.remove('active'));
          element.classList.add('active');
        }
        recomputeFilteredHistory();
        renderHistoryPage(false);
      }

      function renderPortfolio(portfolio) {
        const list = document.getElementById('portfolio-list');
        const placeholder = document.getElementById('portfolio-placeholder');
        list.innerHTML = '';
        if (!portfolio || portfolio.length === 0) { placeholder.style.display = 'block'; return; }
        placeholder.style.display = 'none';

        const currency = userPrefs.currency;
        const currencySymbol = currency === 'RUB' ? '₽' : (currency === 'USD' ? '$' : '€');

        portfolio.forEach(item => {
          const el = document.createElement('div');
          el.className = 'glass-card';
          const uid = devMode ? `<b>#${item.shortId}</b> · ` : '';
          el.innerHTML = `${uid}${fmtMoney(item.amount, currency)} ${currencySymbol} · <b>${item.rate}%</b>`;
          list.appendChild(el);
        });
      }

      // -------- API --------
      async function apiGet(path) {
        try {
          const r = await fetch(`${SCRIPT_URL}${path}`);
          if (!r.ok) throw new Error(`Network error: ${r.statusText}`);
          const data = await r.json();
          if (!data) throw new Error("Empty response from server");
          return data;
        } catch (e) {
          console.error("API Fetch Error:", e);
          return { success: false, error: e.message };
        }
      }

      async function initializeApp() {
        try {
          const tg = window.Telegram?.WebApp;
          tg?.expand?.();
          username = (tg?.initDataUnsafe?.user?.username) || 'marulin';

          setStatus('Загрузка данных...', 'loading');

          const data = await apiGet(`?action=getInitialData&username=${username}`);
          if (!data.success) throw new Error(data.error || 'Failed to get initial data');

          userPrefs = data.userPrefs || { currency: 'RUB', sbpMethods: [] };
          devMode = localStorage.getItem('devMode') === 'true';
          document.getElementById('devModeToggle').checked = devMode;

          serverState = { ...serverState, ...data };
          updateDashboard(serverState);
          recomputeFilteredHistory();
          renderHistoryPage(false);
          renderPortfolio(serverState.portfolio);
          await refreshTodayIncome();
          updateWithdrawUI();

          setStatus('Синхронизировано', 'synced');

          setInterval(syncBalance, 20000);
          setInterval(refreshTodayIncome, 60000);

        } catch (e) {
          console.error('Initialization error:', e);
          setStatus(`Ошибка: ${e.message}`, 'error');
        }
      }

      async function syncBalance() {
        try {
          const data = await apiGet(`?action=syncBalance&username=${username}`);
          if (data && data.success) {
            updateDashboard(data);
            // не показываем статус — он игнорируется после первого
            // setStatus('Синхронизировано', 'synced');
          }
        } catch (error) { /* silent */ }
      }

      async function refreshTodayIncome() {
        try {
          const res = await apiGet(`?action=previewAccrual&username=${username}`);
          if (res && res.success) {
            latestTodayIncomeRub = Number(res.accruedToday || 0);
            document.getElementById('todayIncome').textContent =
              `+${fmtMoney(latestTodayIncomeRub, userPrefs.currency)}`;
          }
        } catch (e) { /* silent */ }
      }

      // -------- EVENTS --------
      function setupEventListeners() {
        const $id = (x) => document.getElementById(x);
        const onIf = (el, ev, fn, opts) => { if (el) el.addEventListener(ev, fn, opts); };

        // Делегирование: клик по оверлею закрывает модалку; клик вне дропдауна валюты — закрыть
        document.addEventListener('click', (e) => {
          if (e.target?.classList?.contains('modal-overlay')) e.target.classList.remove('active');
          const anyOpen = Array.from(document.querySelectorAll('.modal-overlay')).some(m => m.classList.contains('active'));
          if (!anyOpen) document.body.classList.remove('modal-open');

          const currencyDropdown = $id('currencyDropdown');
          const currencyToggler  = document.querySelector('.balance-currency');
          if (currencyDropdown && currencyToggler && !currencyDropdown.contains(e.target) && !currencyToggler.contains(e.target)) {
            currencyDropdown.classList.remove('open');
          }
        });

        // Dev mode
        onIf($id('devModeToggle'), 'change', function () {
          devMode = this.checked;
          localStorage.setItem('devMode', devMode);
          renderHistoryPage(false);
          renderPortfolio(serverState.portfolio);
        });

        // Deposit
        onIf($id('depositAgree'), 'change', function () {
          const btn = $id('depositConfirmBtn');
          if (btn) btn.disabled = !this.checked;
        });

        onIf($id('depositConfirmBtn'), 'click', async function () {
          const amountEl = $id('depositAmount');
          const amount = amountEl ? parseInt(amountEl.value.replace(/\s/g, '')) || 0 : 0;
          if (amount <= 0) { showPopup('Введите сумму.'); return; }
          this.disabled = true;
          try {
            const resp = await apiGet(`?action=requestDeposit&username=${username}&amount=${amount}`);
            if (resp.success) {
              showPopup('Запрос на депозит отправлен!');
              closeModal('deposit');
              initializeApp();
            } else {
              showPopup('Ошибка: ' + (resp.error || 'неизвестно'));
            }
          } catch (e) {
            showPopup('Сетевая ошибка.');
          } finally { this.disabled = false; }
        });

        // Withdraw — выбор банка
        document.querySelectorAll('.bank-icon').forEach(icon => {
          icon.addEventListener('click', () => {
            document.querySelectorAll('.bank-icon').forEach(i => i.classList.remove('selected'));
            icon.classList.add('selected');
          });
        });

        onIf($id('save-sbp-btn'), 'click', async function () {
          const phoneEl = $id('withdraw-sbp-phone');
          const phone = phoneEl ? phoneEl.value : '';
          const selectedBankEl = document.querySelector('.bank-icon.selected');
          if (!phone || !selectedBankEl) { showPopup('Пожалуйста, введите номер и выберите банк.'); return; }
          const bank = selectedBankEl.dataset.bank;
          userPrefs.sbpMethods = userPrefs.sbpMethods || [];
          userPrefs.sbpMethods.unshift({ phone, bank });

          this.disabled = true;
          try {
            const resp = await apiGet(`?action=saveUserPrefs&username=${username}&prefs=${encodeURIComponent(JSON.stringify(userPrefs))}`);
            if (resp.success) {
              userPrefs = resp.savedPrefs;
              updateWithdrawUI();
            } else {
              showPopup('Не удалось сохранить реквизиты.');
            }
          } catch (e) {
            showPopup('Ошибка сети.');
          } finally { this.disabled = false; }
        });

        onIf($id('withdraw-recipient-select'), 'change', function () {
          if (this.value === 'add_new') {
            $id('withdraw-view').style.display = 'none';
            $id('withdraw-method-choice').style.display = 'block';
          }
        });

        onIf($id('withdrawConfirmBtn'), 'click', async function () {
          const amountEl = $id('withdrawAmount');
          const selEl = $id('withdraw-recipient-select');
          const amount = amountEl ? parseInt(amountEl.value.replace(/\s/g, '')) || 0 : 0;
          const idx = selEl ? selEl.value : -1;
          const recipient = (userPrefs.sbpMethods || [])[idx];
          const available = (serverState.balance || 0) - (serverState.lockedAmount || 0);

          if (amount <= 0) { showPopup('Введите сумму.'); return; }
          if (amount > available) { showPopup('Недостаточно свободных средств.'); return; }
          if (!recipient) { showPopup('Выберите реквизиты для вывода.'); return; }

          this.disabled = true;
          try {
            const details = JSON.stringify({ method: 'sbp', phone: recipient.phone, bank: recipient.bank });
            const resp = await apiGet(`?action=requestWithdraw&username=${username}&amount=${amount}&details=${encodeURIComponent(details)}`);
            if (resp.success) {
              showPopup('Запрос на вывод отправлен!');
              closeModal('withdraw');
              initializeApp();
            } else {
              showPopup('Ошибка: ' + (resp.error || 'неизвестно'));
            }
          } catch (e) {
            showPopup('Сетевая ошибка.');
          } finally { this.disabled = false; }
        });

        // New Investment
        onIf($id('niConfirmBtn'), 'click', async function () {
          const amountEl = $id('niAmount');
          const amount = amountEl ? parseInt(amountEl.value.replace(/\s/g, '')) || 0 : 0;
          const rate = lastChosenRate;
          if (!rate || amount <= 0) { showPopup('Введите корректную сумму.'); return; }
          this.disabled = true;
          try {
            const resp = await apiGet(`?action=logStrategyInvestment&username=${username}&rate=${rate}&amount=${amount}`);
            if (resp.success) {
              showPopup('Инвестиция создана!');
              closeModal('newInvestment');
              initializeApp();
            } else {
              showPopup('Ошибка: ' + (resp.error || 'неизвестно'));
            }
          } catch (e) {
            showPopup('Ошибка сети');
          } finally { this.disabled = false; }
        });

        // История — «Загрузить ещё»
        onIf($id('load-more-history'), 'click', () => {
          renderHistoryPage(true);
        });
      }

      // -------- UI UTILS --------
      function setDepositAmount(amount) {
        const input = document.getElementById('depositAmount');
        input.value = amount;
        formatAmountInput(input);
      }

      function toggleCurrencyDropdown(event) {
        event.stopPropagation();
        document.getElementById('currencyDropdown').classList.toggle('open');
      }

      async function selectCurrency(currency, event) {
        event.stopPropagation();
        userPrefs.currency = currency;
        document.getElementById('currentCurrency').textContent = currency;
        document.querySelectorAll('.currency-option').forEach(opt => opt.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById('currencyDropdown').classList.remove('open');

        updateDashboard(serverState);
        recomputeFilteredHistory();
        renderHistoryPage(false);
        renderPortfolio(serverState.portfolio);

        await apiGet(`?action=saveUserPrefs&username=${username}&prefs=${encodeURIComponent(JSON.stringify(userPrefs))}`);
      }

      function openNewInvestment(rate) {
        lastChosenRate = rate;
        const name = `Стратегия ${rate}%`;
        document.getElementById('niStrategyReadonly').textContent = name;
        document.getElementById('niAmount').value = '';
        ['strategy16', 'strategy17', 'strategy18'].forEach(m => closeModal(m));
        openModal('newInvestment');
      }

      function showAddRecipientForm(method) {
        if (method !== 'sbp') return;
        document.getElementById('withdraw-method-choice').style.display = 'none';
        document.getElementById('withdraw-add-sbp-form').style.display = 'block';
        const phoneInput = document.getElementById('withdraw-sbp-phone');
        if (phoneInput) phoneInput.focus();
        document.querySelectorAll('.bank-icon').forEach(i => i.classList.remove('selected'));
      }

      function updateWithdrawUI() {
        const select = document.getElementById('withdraw-recipient-select');
        select.innerHTML = '';

        if (userPrefs.sbpMethods && userPrefs.sbpMethods.length > 0) {
          userPrefs.sbpMethods.forEach((method, index) => {
            const option = document.createElement('option');
            option.value = index;
            option.textContent = `СБП: ${method.phone} (${method.bank})`;
            select.appendChild(option);
          });
          const addNewOption = document.createElement('option');
          addNewOption.value = 'add_new';
          addNewOption.textContent = '+ Добавить новые реквизиты';
          select.appendChild(addNewOption);

          document.getElementById('withdraw-view').style.display = 'block';
          document.getElementById('withdraw-method-choice').style.display = 'none';
          document.getElementById('withdraw-add-sbp-form').style.display = 'none';

        } else {
          document.getElementById('withdraw-view').style.display = 'none';
          document.getElementById('withdraw-method-choice').style.display = 'block';
          document.getElementById('withdraw-add-sbp-form').style.display = 'none';
        }
      }

      // Надёжное копирование + смена иконки на галочку на 2 сек
      async function copyToClipboard(text, btnEl) {
        const ok = await (async () => {
          try {
            if (navigator.clipboard && window.isSecureContext) {
              await navigator.clipboard.writeText(text);
              return true;
            }
            throw new Error();
          } catch {
            try {
              const ta = document.createElement('textarea');
              ta.value = text; ta.setAttribute('readonly',''); ta.style.position='fixed'; ta.style.left='-9999px';
              document.body.appendChild(ta); ta.select(); ta.setSelectionRange(0, ta.value.length);
              const res = document.execCommand('copy'); document.body.removeChild(ta);
              return res;
            } catch { return false; }
          }
        })();

        if (ok) {
          if (btnEl) {
            if (!btnEl.dataset.orig) btnEl.dataset.orig = btnEl.innerHTML;
            btnEl.innerHTML = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>';
            setTimeout(() => { btnEl.innerHTML = btnEl.dataset.orig; }, 2000);
          }
          showPopup('Номер скопирован');
        } else {
          showPopup('Не удалось скопировать. Скопируйте вручную.');
        }
      }

      // -------- INIT --------
      document.addEventListener('DOMContentLoaded', () => {
        setupEventListeners();
        initializeApp();
      });
    </script>
  </body>
</html>

